<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Al-Mohafiz: Interactive microbiome-metabolic modeling using Shannon Entropy to predict Type 2 Diabetes risk. Built by Waseem Ahanger for BURAK Platform.">
    <meta name="keywords" content="microbiome, Type 2 Diabetes, Shannon Entropy, metabolic health, Akkermansia, gut health, BURAK, computational medicine">
    <meta name="author" content="Waseem Ahanger">
    <meta name="theme-color" content="#10b981">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Al-Mohafiz | BURAK Clinical Intelligence">
    <meta property="og:description" content="Interactive gut-metabolic modeling for T2D risk assessment using Shannon Entropy. Pure math. Zero AI.">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/0a0e27/10b981?text=AL-MOHAFIZ">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Al-Mohafiz | BURAK Clinical Intelligence">
    <meta property="twitter:description" content="Interactive gut-metabolic modeling for T2D risk assessment. Pure math. Zero AI.">
    
    <title>Al-Mohafiz | BURAK Clinical Intelligence Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Space+Grotesk:wght@400;600;800&family=Noto+Sans+Arabic:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        :root {
            --emerald: #10b981; --amber: #f59e0b; --rose: #ef4444; 
            --blue: #3b82f6; --purple: #a855f7; --cyan: #06b6d4; --indigo: #6366f1;
            --bg-body: #05070a; --border: rgba(255,255,255,0.08); 
            --bg-card: rgba(255,255,255,0.06); --text-primary: #f8fafc; 
            --text-muted: #94a3b8; --ring-color: var(--emerald);
        }

        body {
            font-family: 'Space Grotesk', 'Noto Sans Arabic', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #05070a 100%);
            color: var(--text-primary); min-height: 100vh; overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.05), transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(16, 185, 129, 0.05), transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.03), transparent 60%);
            animation: backgroundShift 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes backgroundShift {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Animated Background Particles */
        .particle-bg {
            position: fixed; inset: 0; z-index: 0; pointer-events: none;
            background: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.03) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(16, 185, 129, 0.03) 0%, transparent 50%);
        }

        .story-canvas {
            width: 100vw; min-height: 100vh; position: relative; z-index: 1;
            display: flex; flex-direction: column;
        }

        /* Enhanced Header */
        header {
            padding: 25px 50px; display: flex; justify-content: space-between; align-items: center;
            position: fixed; top: 0; left: 0; right: 0; z-index: 3000; 
            border-bottom: 1px solid var(--border);
            background: rgba(5, 7, 10, 0.95); backdrop-filter: blur(25px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .brand { display: flex; align-items: center; gap: 15px; }
        .brand-icon { 
            width: 48px; height: 48px; background: linear-gradient(135deg, var(--emerald), var(--cyan));
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 24px; box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
        }
        .brand h1 { 
            font-size: 18px; font-weight: 900; letter-spacing: 3px;
            background: linear-gradient(135deg, #fff, var(--cyan));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .arabic-sub { 
            font-family: 'Noto Sans Arabic'; font-size: 11px; 
            color: var(--cyan); margin-top: 2px; opacity: 0.8;
        }

        .header-stats {
            display: flex; gap: 25px; align-items: center;
        }
        .stat-pill {
            padding: 10px 20px; border-radius: 20px; 
            background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            font-size: 11px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-pill span { 
            font-family: 'JetBrains Mono'; font-size: 16px; 
            margin-left: 8px; 
            /* color removed - controlled by JavaScript */
            transition: color 0.4s ease;
        }

        /* Progress Navigation */
        .progress-nav {
            position: fixed; top: 100px; left: 50%; transform: translateX(-50%);
            z-index: 2500; display: flex; gap: 12px; align-items: center;
            background: rgba(5, 7, 10, 0.9); backdrop-filter: blur(15px);
            padding: 15px 30px; border-radius: 40px; border: 1px solid var(--border);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        .nav-dot { 
            width: 12px; height: 12px; border-radius: 50%; 
            background: var(--border); cursor: pointer; transition: 0.4s;
            position: relative;
        }
        .nav-dot:hover { transform: scale(1.3); background: rgba(59, 130, 246, 0.5); }
        .nav-dot.active { 
            width: 40px; border-radius: 20px; background: var(--blue); 
            box-shadow: 0 0 20px var(--blue);
        }
        .nav-label {
            position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            font-size: 9px; font-weight: 800; text-transform: uppercase;
            white-space: nowrap; opacity: 0; transition: 0.3s; pointer-events: none;
            color: var(--cyan);
        }
        .nav-dot:hover .nav-label { opacity: 1; top: -35px; }

        .stage {
            position: absolute; inset: 0; display: flex; flex-direction: column; 
            justify-content: flex-start; align-items: center; 
            padding: 180px 50px 50px 50px; transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            opacity: 0; pointer-events: none; overflow-y: auto;
        }
        .stage.active { opacity: 1; pointer-events: all; position: relative; }

        /* ============ PHASE 1: THE GUARDIAN ============ */
        .guardian-grid { 
            display: grid; grid-template-columns: 1.3fr 1fr; gap: 50px; 
            width: 100%; max-width: 1400px; align-items: flex-start; 
        }

        /* Mega Shannon Dial */
        .mega-dial-container {
            position: relative; padding: 40px;
        }
        .mega-dial {
            width: 320px; height: 320px; margin: 0 auto;
            border: 20px solid rgba(255, 255, 255, 0.02);
            border-radius: 50%; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; position: relative; 
            cursor: pointer; transition: 0.5s;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, transparent 70%);
        }
        .mega-dial:hover { transform: scale(1.05) rotate(5deg); }
        .mega-dial::after {
            content: ''; position: absolute; inset: -20px; 
            border: 20px solid var(--ring-color); border-radius: 50%; 
            border-bottom-color: transparent; border-left-color: transparent;
            transition: 1.5s cubic-bezier(0.34, 1.56, 0.64, 1); 
            transform: rotate(var(--angle, 320deg));
            filter: drop-shadow(0 0 30px var(--ring-color));
            animation: pulse-ring 3s infinite;
        }
        @keyframes pulse-ring {
            0%, 100% { filter: drop-shadow(0 0 30px var(--ring-color)); }
            50% { filter: drop-shadow(0 0 50px var(--ring-color)); }
        }

        .dial-icon { 
            font-size: 48px; margin-bottom: 10px;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .dial-label { 
            font-size: 11px; font-weight: 900; color: var(--text-muted); 
            text-transform: uppercase; letter-spacing: 2px; margin-bottom: 5px;
        }
        .dial-value { 
            font-size: 80px; font-weight: 900; font-family: 'JetBrains Mono'; 
            color: var(--ring-color); line-height: 1;
            text-shadow: 0 0 60px var(--ring-color);
            transition: 0.5s;
        }
        .dial-status { 
            margin-top: 15px; padding: 10px 24px; border-radius: 25px;
            font-size: 12px; font-weight: 900; text-transform: uppercase;
            background: var(--ring-color); color: #000; letter-spacing: 1px;
            box-shadow: 0 4px 20px var(--ring-color);
        }

        /* Interactive Cards */
        .info-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
            padding: 28px; border-radius: 24px; border-left: 4px solid var(--blue);
            margin-top: 20px; font-size: 14px; line-height: 1.8; text-align: left;
            transition: 0.4s; position: relative; overflow: hidden;
            backdrop-filter: blur(10px);
        }
        .info-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--blue), transparent);
            opacity: 0; transition: 0.3s;
        }
        .info-card:hover { 
            background: rgba(255,255,255,0.06); transform: translateX(8px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .info-card:hover::before { opacity: 1; }
        
        .card-icon {
            font-size: 28px; margin-bottom: 12px; display: block;
            filter: drop-shadow(0 0 10px currentColor);
        }
        .card-title { 
            font-size: 13px; text-transform: uppercase; color: var(--blue); 
            margin-bottom: 10px; letter-spacing: 1px; font-weight: 900;
            display: flex; align-items: center; gap: 8px;
        }
        .arabic-text { 
            font-family: 'Noto Sans Arabic'; font-size: 13px; margin-top: 10px; 
            display: block; opacity: 0.7; line-height: 2; color: var(--cyan);
            font-style: italic;
        }

        /* Control Panel with Neon Effects */
        .control-panel { 
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08) 0%, rgba(16, 185, 129, 0.08) 100%);
            padding: 40px; border-radius: 40px; 
            border: 1px solid var(--border); position: relative; overflow: hidden;
        }
        .control-panel::before {
            content: ''; position: absolute; top: -50%; left: -50%; 
            width: 200%; height: 200%; 
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            animation: rotate-gradient 15s linear infinite;
            pointer-events: none;
        }
        @keyframes rotate-gradient {
            to { transform: rotate(360deg); }
        }

        .panel-title {
            font-size: 14px; font-weight: 900; color: var(--purple); 
            text-transform: uppercase; letter-spacing: 2px; margin-bottom: 30px;
            display: flex; align-items: center; gap: 10px;
        }
        .panel-title::before {
            content: 'ğŸ§¬'; font-size: 24px;
        }

        /* Enhanced Sliders */
        .slider-group { 
            margin-bottom: 30px; position: relative; z-index: 1;
            padding: 20px; border-radius: 20px;
            background: rgba(0,0,0,0.2); backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s;
        }
        .slider-group:hover {
            background: rgba(0,0,0,0.3);
            border-color: var(--blue);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.2);
        }
        
        .slider-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px;
        }
        .slider-label {
            font-size: 12px; font-weight: 900; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 1.5px;
            display: flex; align-items: center; gap: 8px;
        }
        .slider-label::before {
            content: attr(data-icon); font-size: 20px;
        }
        .slider-value {
            font-family: 'JetBrains Mono'; font-size: 24px; font-weight: 900;
            color: var(--emerald); text-shadow: 0 0 20px currentColor;
        }

        .custom-slider { 
            width: 100%; appearance: none; height: 8px; 
            background: linear-gradient(90deg, 
                var(--rose) 0%, 
                var(--amber) 40%, 
                var(--emerald) 100%);
            border-radius: 10px; outline: none; cursor: pointer;
            transition: 0.3s; position: relative;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        }
        .custom-slider:hover { height: 10px; }
        .custom-slider::-webkit-slider-thumb { 
            appearance: none; width: 32px; height: 32px; 
            background: linear-gradient(135deg, #fff, var(--cyan));
            border-radius: 50%; cursor: grab; 
            border: 4px solid var(--blue);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6),
                        inset 0 -2px 5px rgba(0,0,0,0.2);
            transition: 0.2s;
        }
        .custom-slider::-webkit-slider-thumb:hover { 
            transform: scale(1.3); 
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.8);
        }
        .custom-slider::-webkit-slider-thumb:active { 
            cursor: grabbing; transform: scale(1.1);
        }

        .ref-range { 
            font-size: 10px; font-family: 'JetBrains Mono'; 
            color: var(--amber); margin-top: 8px; display: flex;
            align-items: center; gap: 6px; opacity: 0.8;
        }
        .ref-range::before { content: 'âš ï¸'; }

        /* Alert Box */
        .erosion-alert {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.05) 100%);
            border: 2px solid var(--rose); border-radius: 20px; padding: 25px;
            margin-top: 25px; animation: alert-pulse 2s infinite;
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.3);
        }
        @keyframes alert-pulse {
            0%, 100% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 0 50px rgba(239, 68, 68, 0.6); }
        }
        .alert-icon {
            font-size: 40px; margin-bottom: 15px; display: block;
            animation: shake 0.5s infinite;
        }
        @keyframes shake { 
            0%, 100% { transform: translateX(0) rotate(0deg); } 
            25% { transform: translateX(-5px) rotate(-5deg); } 
            75% { transform: translateX(5px) rotate(5deg); } 
        }
        .alert-text {
            font-size: 16px; font-weight: 900; color: var(--rose);
            text-transform: uppercase; letter-spacing: 1px;
        }

        /* CTA Button */
        .btn-mega { 
            width: 100%; padding: 25px 50px; border-radius: 60px; 
            border: 2px solid var(--border); 
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(99, 102, 241, 0.2));
            color: #fff; font-weight: 900; text-transform: uppercase; 
            cursor: pointer; transition: 0.4s; font-size: 13px; 
            letter-spacing: 2px; position: relative; overflow: hidden;
            margin-top: 30px; backdrop-filter: blur(10px);
        }
        .btn-mega::before {
            content: ''; position: absolute; inset: 0; 
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%); transition: 0.6s;
        }
        .btn-mega:hover::before { transform: translateX(100%); }
        .btn-mega:hover { 
            background: linear-gradient(135deg, var(--blue), var(--indigo));
            border-color: var(--blue); transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.5);
        }
        .btn-mega span {
            position: relative; z-index: 1;
        }

        /* ============ PHASE 2: MIXER ============ */
        .mixer-layout {
            display: grid; grid-template-columns: 500px auto 500px; 
            gap: 40px; width: 100%; max-width: 1600px; align-items: flex-start;
        }

        .mixer-title {
            text-align: center; margin-bottom: 40px;
        }
        .mixer-title h2 {
            font-size: 42px; font-weight: 900; letter-spacing: -1px;
            background: linear-gradient(135deg, #fff, var(--cyan));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .mixer-subtitle {
            font-family: 'Noto Sans Arabic'; font-size: 20px; 
            color: var(--cyan); opacity: 0.8;
        }

        .mixer-column { 
            background: linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.01) 100%);
            padding: 45px; border-radius: 40px; border: 1px solid var(--border);
            backdrop-filter: blur(15px);
        }

        .biomarker-input {
            margin-top: 20px; padding: 20px; border-radius: 20px;
            background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s; display: flex; justify-content: space-between;
            align-items: center;
        }
        .biomarker-input:hover {
            background: rgba(0,0,0,0.3); border-color: var(--blue);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.2);
        }
        .biomarker-label {
            font-size: 13px; font-weight: 900; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 1px;
        }
        .biomarker-label::before {
            content: attr(data-icon); font-size: 20px; margin-right: 10px;
        }
        input[type="number"] { 
            background: rgba(255,255,255,0.08); border: 2px solid var(--border); 
            color: #fff; padding: 15px 20px; border-radius: 16px; 
            font-family: 'JetBrains Mono'; width: 120px; text-align: center; 
            font-size: 24px; outline: none; transition: 0.3s; font-weight: 900;
        }
        input[type="number"]:focus { 
            border-color: var(--blue); 
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
            background: rgba(255,255,255,0.12);
        }

        /* Mixing Animation */
        .mixer-center {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; text-align: center;
        }
        .mixing-orb {
            width: 200px; height: 200px; border-radius: 50%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.3), transparent);
            display: flex; align-items: center; justify-content: center;
            position: relative; animation: orb-pulse 3s infinite;
            margin: 30px 0;
        }
        @keyframes orb-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 50px rgba(59, 130, 246, 0.5); }
            50% { transform: scale(1.1); box-shadow: 0 0 80px rgba(59, 130, 246, 0.8); }
        }
        .mixing-symbol { 
            font-size: 80px; animation: spin 6s linear infinite;
            filter: drop-shadow(0 0 30px var(--blue));
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .tension-value {
            font-size: 90px; font-weight: 900; font-family: 'JetBrains Mono';
            color: var(--emerald); margin: 20px 0;
            text-shadow: 0 0 60px currentColor; line-height: 1;
        }
        .tension-label {
            font-size: 12px; font-weight: 900; text-transform: uppercase;
            letter-spacing: 2px; color: var(--text-muted);
        }
        .formula-display {
            margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3);
            border-radius: 15px; font-family: 'JetBrains Mono'; font-size: 11px;
            color: var(--amber); border: 1px solid rgba(245, 158, 11, 0.2);
        }

        /* Status Badge */
        .status-badge {
            padding: 15px 30px; border-radius: 30px; font-size: 13px;
            font-weight: 900; text-transform: uppercase; letter-spacing: 1.5px;
            margin: 25px 0; box-shadow: 0 4px 20px currentColor;
            display: inline-block;
        }

        /* ============ PHASE 3: INTERACTIVE GRAPH ============ */
        .graph-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0.01) 100%);
            border-radius: 50px; padding: 60px; width: 100%; max-width: 1300px;
            border: 1px solid var(--border); backdrop-filter: blur(15px);
        }

        .graph-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 50px; flex-wrap: wrap; gap: 20px;
        }
        .graph-title h2 {
            font-size: 38px; font-weight: 900; letter-spacing: -1px;
        }
        .graph-subtitle {
            font-family: 'Noto Sans Arabic'; font-size: 18px;
            color: var(--cyan); margin-top: 8px;
        }

        .svg-graph { 
            width: 100%; height: 500px; overflow: visible; 
            cursor: crosshair; border-radius: 20px;
            background: rgba(0,0,0,0.2);
        }

        /* Interactive Marker */
        .marker-dot { 
            cursor: grab; transition: 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 0 30px currentColor);
        }
        .marker-dot:hover { 
            r: 25; cursor: pointer;
            filter: drop-shadow(0 0 50px currentColor);
        }
        .marker-dot:active { cursor: grabbing; }

        /* Zone Cards */
        .zone-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 25px; margin-top: 40px;
        }
        .zone-card {
            padding: 30px; border-radius: 25px; text-align: center;
            border: 2px solid; transition: 0.4s;
            background: rgba(0,0,0,0.2); backdrop-filter: blur(10px);
        }
        .zone-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }
        .zone-icon {
            font-size: 48px; margin-bottom: 15px; display: block;
            filter: drop-shadow(0 0 20px currentColor);
        }
        .zone-title {
            font-size: 16px; font-weight: 900; margin-bottom: 12px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .zone-desc {
            font-size: 13px; line-height: 1.7; opacity: 0.9;
        }

        /* ============ PHASE 4: GANGRENE DEEP DIVE ============ */
        .gangrene-report {
            width: 100%; max-width: 1400px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            color: #0a0e27; border-radius: 50px; padding: 70px;
            box-shadow: 0 50px 200px rgba(0,0,0,0.6);
            border: 3px solid #e2e8f0;
        }

        .report-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 60px;
        }

        /* Risk Score Display */
        .risk-display {
            text-align: center; padding: 40px;
            background: linear-gradient(135deg, #fef2f2 0%, #fff 100%);
            border-radius: 35px; border: 3px solid #fecaca;
            box-shadow: inset 0 2px 20px rgba(239, 68, 68, 0.1);
        }
        .risk-icon {
            font-size: 80px; margin-bottom: 20px;
            animation: danger-pulse 2s infinite;
        }
        @keyframes danger-pulse {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 20px #ef4444); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 40px #ef4444); }
        }
        .risk-score {
            font-size: 120px; font-weight: 900; font-family: 'JetBrains Mono';
            color: #dc2626; line-height: 1; text-shadow: 0 4px 20px rgba(220, 38, 38, 0.3);
        }
        .risk-label {
            font-size: 14px; font-weight: 900; text-transform: uppercase;
            color: #991b1b; letter-spacing: 2px; margin-top: 15px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
            margin-top: 30px;
        }
        .metric-box {
            padding: 25px; border-radius: 20px; text-align: center;
            background: #f8fafc; border: 2px solid #e2e8f0;
            transition: 0.3s;
        }
        .metric-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            border-color: #cbd5e1;
        }
        .metric-label {
            font-size: 11px; color: #64748b; text-transform: uppercase;
            letter-spacing: 1px; margin-bottom: 10px; font-weight: 800;
        }
        .metric-value {
            font-family: 'JetBrains Mono'; font-size: 36px; font-weight: 900;
        }

        /* Pathology Section */
        .pathology-section h3 {
            font-size: 32px; font-weight: 900; margin-bottom: 20px;
            color: #0a0e27; display: flex; align-items: center; gap: 15px;
        }
        .pathology-section h3::before {
            content: 'âš ï¸'; font-size: 40px;
        }

        /* Formula Breakdown */
        .formula-breakdown {
            background: #1e293b; color: #fff; padding: 35px;
            border-radius: 25px; margin: 30px 0;
            border: 3px solid #334155;
        }
        .formula-title {
            font-size: 14px; font-weight: 900; color: var(--amber);
            text-transform: uppercase; letter-spacing: 2px;
            margin-bottom: 20px; display: flex; align-items: center; gap: 10px;
        }
        .formula-title::before { content: 'ğŸ§®'; font-size: 24px; }

        .formula-line {
            font-family: 'JetBrains Mono'; font-size: 16px;
            padding: 15px; background: rgba(255,255,255,0.05);
            border-radius: 12px; margin: 15px 0;
            border-left: 4px solid var(--cyan);
            transition: 0.3s;
        }
        .formula-line:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }
        .formula-var {
            color: var(--emerald); font-weight: 900;
        }
        .formula-result {
            color: var(--rose); font-weight: 900; font-size: 20px;
        }

        /* Mechanism Steps */
        .mechanism-steps {
            margin: 30px 0;
        }
        .step {
            padding: 25px; margin: 20px 0; border-radius: 20px;
            background: #f1f5f9; border-left: 5px solid;
            transition: 0.3s;
        }
        .step:hover {
            transform: translateX(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .step-number {
            font-size: 32px; font-weight: 900; font-family: 'JetBrains Mono';
            margin-bottom: 10px; opacity: 0.3;
        }
        .step-title {
            font-size: 16px; font-weight: 900; margin-bottom: 10px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .step-desc {
            font-size: 14px; line-height: 1.8; color: #475569;
        }

        /* Evidence Pills */
        .evidence-pills {
            display: flex; flex-wrap: wrap; gap: 15px; margin: 30px 0;
        }
        .evidence-pill {
            padding: 12px 24px; border-radius: 25px;
            background: linear-gradient(135deg, #dbeafe, #e0e7ff);
            border: 2px solid #93c5fd; font-size: 11px; font-weight: 900;
            text-transform: uppercase; letter-spacing: 0.5px;
            color: #1e40af; transition: 0.3s; cursor: pointer;
        }
        .evidence-pill:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }

        /* Regional Context Box */
        .gcc-context {
            background: linear-gradient(135deg, #fef3c7 0%, #fef9e7 100%);
            padding: 35px; border-radius: 25px; margin: 30px 0;
            border: 3px solid #fbbf24;
        }
        .gcc-icon {
            font-size: 48px; margin-bottom: 15px;
        }
        .gcc-title {
            font-size: 18px; font-weight: 900; color: #92400e;
            margin-bottom: 15px; text-transform: uppercase;
        }
        .gcc-desc {
            font-size: 14px; line-height: 1.9; color: #78350f;
        }

        /* Back to Top */
        .btn-restart {
            width: 100%; padding: 25px; border-radius: 50px;
            background: linear-gradient(135deg, var(--indigo), var(--purple));
            color: #fff; font-size: 14px; font-weight: 900;
            text-transform: uppercase; letter-spacing: 2px;
            cursor: pointer; border: none; margin-top: 40px;
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.4);
            transition: 0.4s;
        }
        .btn-restart:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 50px rgba(99, 102, 241, 0.6);
        }

        /* Responsive - Mobile First */
        @media (max-width: 1400px) {
            .guardian-grid, .mixer-layout, .report-grid { 
                grid-template-columns: 1fr; gap: 30px;
            }
            .mega-dial { width: 280px; height: 280px; }
            .dial-value { font-size: 72px; }
        }

        @media (max-width: 768px) {
            /* Header mobile */
            header { 
                padding: 15px 20px; 
                flex-direction: column; 
                gap: 12px;
                align-items: stretch;
            }
            .brand { justify-content: center; }
            .brand-icon { width: 40px; height: 40px; font-size: 20px; }
            .brand h1 { font-size: 16px; }
            .header-stats { 
                flex-direction: row; 
                justify-content: space-around; 
                gap: 10px;
                flex-wrap: wrap;
            }
            .stat-pill { 
                padding: 8px 15px; 
                font-size: 10px;
                flex: 1;
                min-width: 100px;
                text-align: center;
            }
            .stat-pill span { font-size: 14px; }
            
            /* Progress nav mobile */
            .progress-nav { 
                top: 120px; 
                padding: 10px 20px;
                gap: 8px;
            }
            .nav-dot { width: 10px; height: 10px; }
            .nav-dot.active { width: 30px; }
            
            /* Compute overlay mobile */
            #compute-overlay > div {
                padding: 20px;
            }
            #compute-overlay > div > div:first-child {
                width: 80px !important;
                height: 80px !important;
                font-size: 40px !important;
            }
            #compute-overlay > div > div:nth-child(2) {
                font-size: 20px !important;
            }
            #compute-steps-display {
                min-width: auto !important;
                max-width: 90vw !important;
                padding: 20px !important;
                font-size: 12px !important;
            }
            #compute-overlay > div > div:nth-child(4) {
                width: 90vw !important;
                max-width: 400px !important;
            }
            
            /* Math Engine mobile */
            div[onclick*="math-note"] {
                bottom: 15px !important;
                right: 50% !important;
                transform: translateX(50%) !important;
                padding: 12px 18px !important;
            }
            #math-note {
                bottom: 70px !important;
                right: 10px !important;
                left: 10px !important;
                max-width: none !important;
            }
            
            /* Stage mobile */
            .stage { 
                padding: 180px 15px 40px 15px; 
            }
            
            /* Dial mobile */
            .mega-dial { width: 240px; height: 240px; }
            .dial-value { font-size: 58px; }
            .dial-icon { font-size: 38px; }
            
            /* Cards mobile */
            .info-card, .mixer-column, .control-panel {
                padding: 25px 20px;
                border-radius: 20px;
            }
            
            /* Sliders mobile */
            .slider-group { padding: 20px 15px; }
            .slider-value { font-size: 20px; }
            .custom-slider { height: 12px; }
            
            /* Inputs mobile */
            input[type="number"] {
                width: 90px;
                font-size: 20px;
                padding: 12px 15px;
            }
            
            /* Graph mobile */
            .trajectory-graph { height: 400px; }
            svg { max-height: 400px; }
            
            /* Zone cards mobile */
            .zone-grid { 
                grid-template-columns: 1fr; 
                gap: 20px;
            }
            .zone-card { padding: 25px 20px; }
            .zone-icon { font-size: 42px; }
            
            /* Metrics mobile */
            .metrics-grid { 
                grid-template-columns: 1fr; 
                gap: 15px;
            }
            
            /* Report mobile */
            .analysis-report { 
                padding: 40px 20px;
                border-radius: 30px;
            }
            .risk-percentage { font-size: 80px; }
            .mechanism-step { padding: 20px 15px; }
            
            /* Buttons mobile */
            .btn-phase, .btn-restart {
                padding: 18px 30px;
                font-size: 11px;
            }
            
            /* Typography mobile */
            h2 { font-size: 28px; }
            h3 { font-size: 22px; }
            .section-title { font-size: 32px; }
            
            /* Touch targets */
            button, input, select, a {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Small mobile phones */
        @media (max-width: 480px) {
            .mega-dial { width: 200px; height: 200px; }
            .dial-value { font-size: 48px; }
            .tension-display { font-size: 52px; }
            .risk-percentage { font-size: 64px; }
            
            .header-stats {
                flex-direction: column;
            }
            .stat-pill {
                width: 100%;
            }
        }

        /* Loading Spinner */
        .loading {
            display: inline-block; width: 20px; height: 20px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--blue); border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Enhanced Animations */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Smooth scroll */
        html { scroll-behavior: smooth; }

        /* Selection */
        ::selection {
            background: var(--blue); color: #fff;
        }
    </style>
</head>
<body>
    <div class="particle-bg"></div>

    <div class="story-canvas">
        <!-- Enhanced Header -->
        <header>
            <div class="brand">
                <div class="brand-icon">ğŸ›¡ï¸</div>
                <div>
                    <h1>BURAK</h1>
                    <div style="font-size: 11px; color: var(--text-muted); font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; margin-top: 3px;">
                        Al-Mohafiz Deep Dive
                    </div>
                    <div class="arabic-sub">Ù…Ø­Ø±Ùƒ Ø±ÙŠØ§Ø¶ÙŠ Ø®Ø§Ù„Øµ | Zero AI Inference</div>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-pill">
                    Guardian <span id="header-shannon">3.82</span>
                </div>
                <div class="stat-pill">
                    Tension <span id="header-tension">1.0x</span>
                </div>
                <button onclick="nextPhase(1)" style="padding: 10px 20px; border-radius: 20px; 
                        background: rgba(99, 102, 241, 0.15); border: 2px solid var(--indigo);
                        color: var(--indigo); font-size: 11px; font-weight: 800; 
                        text-transform: uppercase; letter-spacing: 1px; cursor: pointer;
                        transition: 0.3s;"
                        onmouseover="this.style.background='var(--indigo)'; this.style.color='#fff';"
                        onmouseout="this.style.background='rgba(99, 102, 241, 0.15)'; this.style.color='var(--indigo)';">
                    â† Back to Start
                </button>
            </div>
        </header>

        <!-- Progress Navigation -->
        <div class="progress-nav">
            <div class="nav-dot active" onclick="jumpPhase(1)">
                <span class="nav-label">ğŸ›¡ï¸ Guardian</span>
            </div>
            <div class="nav-dot" onclick="jumpPhase(2)">
                <span class="nav-label">ğŸ”„ Mixer</span>
            </div>
            <div class="nav-dot" onclick="jumpPhase(3)">
                <span class="nav-label">ğŸ“ˆ Trajectory</span>
            </div>
            <div class="nav-dot" onclick="jumpPhase(4)">
                <span class="nav-label">âš ï¸ Risk Analysis</span>
            </div>
        </div>

        <!-- Math Engine Display -->
        <div style="position: fixed; bottom: 30px; right: 30px; z-index: 2800;
                    background: rgba(5, 7, 10, 0.95); backdrop-filter: blur(20px);
                    border: 1px solid var(--border); border-radius: 24px;
                    padding: 15px 22px; display: flex; align-items: center; gap: 12px;
                    box-shadow: 0 8px 32px rgba(0,0,0,0.6); cursor: pointer; transition: 0.3s;"
             onclick="document.getElementById('math-note').style.display = document.getElementById('math-note').style.display === 'none' ? 'block' : 'none';"
             onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 48px rgba(16, 185, 129, 0.4)';"
             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 32px rgba(0,0,0,0.6)';">
            <div style="width: 32px; height: 32px; border-radius: 8px;
                        background: linear-gradient(135deg, var(--emerald), var(--cyan));
                        display: flex; align-items: center; justify-content: center;
                        font-size: 16px; animation: pulse 2s infinite;">
                âš™ï¸
            </div>
            <div style="display: flex; flex-direction: column;">
                <div style="font-size: 9px; color: var(--text-muted); text-transform: uppercase;
                            letter-spacing: 1.2px; font-weight: 800;">
                    Math Engine
                </div>
                <div style="font-size: 12px; color: var(--emerald); font-weight: 900; font-family: 'JetBrains Mono';">
                    ACTIVE
                </div>
            </div>
        </div>

        <!-- Math Engine Education Note -->
        <div id="math-note" style="
            position: fixed; bottom: 90px; right: 30px; z-index: 2799;
            background: rgba(5, 7, 10, 0.98); backdrop-filter: blur(25px);
            border: 2px solid var(--emerald); border-radius: 24px;
            padding: 24px; max-width: 360px;
            box-shadow: 0 12px 48px rgba(16, 185, 129, 0.4);
            font-size: 12px; line-height: 1.9; color: var(--text-primary);
            display: none; animation: slideUp 0.3s;">
            <div style="font-weight: 900; color: var(--emerald); margin-bottom: 12px; 
                        text-transform: uppercase; letter-spacing: 1.5px; font-size: 13px;">
                ğŸ§® Our Secret Sauce
            </div>
            <div style="margin-bottom: 12px;">
                We use <strong style="color: var(--cyan);">pure mathematics</strong> 
                (Shannon Entropy, weighted tension formulas) for the heavy lifting.
            </div>
            <div style="margin-bottom: 12px;">
                <strong>AI?</strong> Only for data preprocessing â€” like a smart 
                <em style="color: var(--amber);">filing clerk</em> who organizes 
                papers before the mathematician arrives.
            </div>
            <div style="padding: 12px; background: rgba(16, 185, 129, 0.08); 
                        border-radius: 12px; border-left: 3px solid var(--emerald); margin-bottom: 12px;">
                <strong style="color: var(--emerald);">Result:</strong><br>
                â€¢ 10x less compute power<br>
                â€¢ 100% transparent results<br>
                â€¢ Zero hallucinations
            </div>
            <div style="color: var(--amber); font-weight: 700; font-style: italic; text-align: center;">
                Math doesn't lie, it calculates.
            </div>
            <div style="font-family: 'Noto Sans Arabic'; direction: rtl; text-align: right; 
                        color: var(--cyan); opacity: 0.9; margin-top: 15px; font-size: 11px; 
                        padding-top: 15px; border-top: 1px solid var(--border);">
                Ù†Ø­Ù† Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ø®Ø§Ù„ØµØ© Ù„Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø©. Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŸ 
                ÙÙ‚Ø· Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ù…Ø«Ù„ ÙƒØ§ØªØ¨ Ø°ÙƒÙŠ ÙŠÙ†Ø¸Ù… Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ù‚Ø¨Ù„ ÙˆØµÙˆÙ„ Ø¹Ø§Ù„Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª.
            </div>
        </div>

        <!-- PHASE 1: GUARDIAN -->
        <section class="stage active" id="phase-1">
            <div class="guardian-grid">
                <!-- Left: Dial + Info -->
                <div>
                    <div class="mega-dial-container">
                        <div class="mega-dial" id="mega-dial" title="Your Biological Sovereignty Power">
                            <div class="dial-icon">ğŸ›¡ï¸</div>
                            <div class="dial-label">SOVEREIGNTY INDEX</div>
                            <div class="dial-value" id="shannon-display">3.82</div>
                            <div class="dial-status" id="status-badge">PROTECTIVE</div>
                        </div>
                    </div>

                    <div class="info-card" style="border-left-color: var(--purple);">
                        <span class="card-icon">ğŸ§¬</span>
                        <div class="card-title">
                            <span>The Guardian Protocol</span>
                            <span style="font-family: 'Noto Sans Arabic';">Ø§Ù„Ù…Ø­Ø§ÙØ¸</span>
                        </div>
                        Think of your gut as a <strong>security system</strong> for your entire body. 
                        The <strong>Shannon Index (H')</strong> measures how many different "guards" you have on duty.
                        <br><br>
                        <strong>Akkermansia</strong> (12%) is your <strong>head of security</strong> ğŸ” â€” 
                        the glue that keeps your intestinal walls sealed. When this drops below 6%, 
                        it's like someone cutting your security camera wires â€” everything else starts failing automatically.
                        <span class="arabic-text">
                            Ø£Ù…Ø¹Ø§Ø¦Ùƒ = Ù†Ø¸Ø§Ù… Ø£Ù…Ù†ÙŠ. Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙŠÙ‚ÙŠØ³ Ø¹Ø¯Ø¯ "Ø§Ù„Ø­Ø±Ø§Ø³" Ø§Ù„Ù†Ø´Ø·ÙŠÙ†. 
                            Ø¨ÙƒØªÙŠØ±ÙŠØ§ Akkermansia Ù‡ÙŠ Ø±Ø¦ÙŠØ³ Ø§Ù„Ø£Ù…Ù† (Ø§Ù„ØºØ±Ø§Ø¡ Ø§Ù„Ø­ÙŠÙˆÙŠ).
                        </span>
                    </div>

                    <div class="info-card" style="border-left-color: var(--cyan);">
                        <span class="card-icon">âš¡</span>
                        <div class="card-title">Why This Matters</div>
                        Your doctor checks if your blood sugar is high <em>right now</em>. 
                        We check the <strong>computational load</strong> â€” how hard your body is working 
                        behind the scenes to keep those numbers normal.
                        <br><br>
                        <strong>High Shannon (H' > 3.5)</strong> = Your body is cruising, minimal effort<br>
                        <strong>Low Shannon (H' < 2.5)</strong> = Your body is in overdrive, burning out
                        <span class="arabic-text">
                            Ø§Ù„Ø·Ø¨ÙŠØ¨ ÙŠÙØ­Øµ Ø§Ù„Ø³ÙƒØ± Ø§Ù„Ø¢Ù†. Ù†Ø­Ù† Ù†ÙØ­Øµ Ø¬Ù‡Ø¯ Ø¬Ø³Ù…Ùƒ Ø§Ù„Ø®ÙÙŠ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ§Ø²Ù†.
                        </span>
                    </div>

                    <div class="info-card" style="border-left-color: var(--amber);">
                        <span class="card-icon">ğŸ®</span>
                        <div class="card-title">Try This Experiment</div>
                        Move the <strong>Akkermansia slider</strong> below 6% on the right â†’
                        <br><br>
                        Watch what happens to the other bacteria. They start <em>automatically eroding</em> 
                        in real-time. This is called <strong>"Cascade Failure"</strong> â€” 
                        exactly what happens in your gut over months when the head guard fails.
                        <span class="arabic-text">
                            Ø¬Ø±Ù‘Ø¨: Ø­Ø±Ùƒ Ù…Ø¤Ø´Ø± Akkermansia Ù„Ø£Ù‚Ù„ Ù…Ù† 6Ùª ÙˆØ´Ø§Ù‡Ø¯ Ø§Ù„Ø§Ù†Ù‡ÙŠØ§Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ.
                        </span>
                    </div>
                </div>

                <!-- Right: Control Panel -->
                <div class="control-panel">
                    <div class="panel-title">
                        ğŸ”¬ Microbiome Erosion Simulator
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <div class="slider-label" data-icon="ğŸ”">
                                The Glue (Akkermansia)
                            </div>
                            <div class="slider-value" id="val-akk">12%</div>
                        </div>
                        <input type="range" class="custom-slider" id="slider-akk" 
                               min="1" max="25" value="12" oninput="handleSlider()">
                        <div class="ref-range">Critical: Must stay > 6% (Your security gate)</div>
                        
                        <div style="margin-top: 12px; padding: 12px; background: rgba(245, 158, 11, 0.08); 
                                    border-left: 3px solid var(--amber); border-radius: 8px; font-size: 11px; 
                                    line-height: 1.7; color: var(--text-primary);">
                            <strong style="color: var(--amber);">âš ï¸ Educational Note:</strong> 
                            When Akkermansia drops below 6%, the <strong>cascade effect</strong> begins. 
                            Other protective species (Faecalibacterium, Bacteroides) start declining automatically. 
                            This models real-world <em>barrier dysfunction</em> â€” when the gut lining weakens, 
                            the entire ecosystem collapses. Watch your Guardian Index (Shannon) plummet 
                            from ~3.5 â†’ ~2.0 within seconds. This simulates a <strong>multi-month deterioration 
                            compressed into real-time</strong>. Color coding: ğŸŸ¢ Green (H' â‰¥ 3.2 protective), 
                            ğŸŸ¡ Amber (H' 2.2-3.2 eroding), ğŸ”´ Red (H' < 2.2 collapsed).
                        </div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <div class="slider-label" data-icon="ğŸ’š">
                                The Healer (Faecalibacterium)
                            </div>
                            <div class="slider-value" id="val-fae">12%</div>
                        </div>
                        <input type="range" class="custom-slider" id="slider-fae" 
                               min="1" max="25" value="12" oninput="calcShannon()">
                        <div class="ref-range">Role: Makes butyrate â€” your gut's repair molecule</div>
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <div class="slider-label" data-icon="ğŸ”¥">
                                The Burner (Bacteroides)
                            </div>
                            <div class="slider-value" id="val-bac">30%</div>
                        </div>
                        <input type="range" class="custom-slider" id="slider-bac" 
                               min="10" max="50" value="30" oninput="calcShannon()">
                        <div class="ref-range">Role: Breaks down fats & complex sugars for energy</div>
                    </div>

                    <div id="alert-box" class="erosion-alert" style="display:none;">
                        <span class="alert-icon">ğŸš¨</span>
                        <div class="alert-text">
                            SECURITY BREACH DETECTED
                        </div>
                        <div style="margin-top: 10px; font-size: 13px; font-weight: 600;">
                            Akkermansia below 6% â†’ Automatic cascade failure active
                        </div>
                        <span class="arabic-text" style="margin-top: 10px;">
                            Ø§Ø®ØªØ±Ø§Ù‚ Ø£Ù…Ù†ÙŠ: Ø§Ù†Ù‡ÙŠØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù†Ø´Ø·
                        </span>
                    </div>

                    <button class="btn-mega" onclick="nextPhase(2)">
                        <span>ğŸ”„ Enter Handshake Mixer â†’ Ù…Ø²Ø¬ Ø§Ù„Ù…ØµØ§ÙØ­Ø©</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- PHASE 2: MIXER -->
        <section class="stage" id="phase-2">
            <div class="mixer-title">
                <h2>âš—ï¸ The Clinical Handshake</h2>
                <div class="mixer-subtitle">Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ù…ØµØ§ÙØ­Ø© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙˆØ§Ù„Ø¯Ù…</div>
            </div>

            <div class="mixer-layout">
                <!-- Left: Blood Markers -->
                <div class="mixer-column">
                    <div class="panel-title">ğŸ©¸ Your Blood Numbers</div>
                    
                    <div class="biomarker-input">
                        <div>
                            <div class="biomarker-label" data-icon="ğŸ’‰">Fasting Insulin</div>
                            <div class="ref-range">Normal: 2-25 Î¼IU/mL</div>
                        </div>
                        <input type="number" id="input-insulin" value="4.2" step="0.1" oninput="mixHandshake()">
                    </div>

                    <div class="biomarker-input">
                        <div>
                            <div class="biomarker-label" data-icon="ğŸ”¥">CRP (Inflammation)</div>
                            <div class="ref-range">Good: < 1.0 mg/L</div>
                        </div>
                        <input type="number" id="input-crp" value="0.4" step="0.1" oninput="mixHandshake()">
                    </div>

                    <div class="biomarker-input">
                        <div>
                            <div class="biomarker-label" data-icon="ğŸ¬">Blood Sugar</div>
                            <div class="ref-range">Normal: 70-99 mg/dL</div>
                        </div>
                        <input type="number" id="input-glucose" value="88" oninput="mixHandshake()">
                    </div>

                    <div class="biomarker-input">
                        <div>
                            <div class="biomarker-label" data-icon="ğŸ§ˆ">Triglycerides</div>
                            <div class="ref-range">Good: < 150 mg/dL</div>
                        </div>
                        <input type="number" id="input-trig" value="110" oninput="mixHandshake()">
                    </div>

                    <div class="info-card" style="border-left-color: var(--cyan); margin-top: 30px;">
                        <span class="card-icon">ğŸ’¡</span>
                        <div class="card-title">Try This</div>
                        Set insulin to <strong>15</strong> (high) while keeping Shannon at 3.82 (good). 
                        You'll see <strong>"Exhaustion"</strong> â€” your gut is working overtime to save you.
                    </div>
                </div>

                <!-- Center: Mixing -->
                <div class="mixer-center">
                    <div style="font-size: 13px; font-weight: 900; color: var(--text-muted); 
                                text-transform: uppercase; letter-spacing: 2px;">
                        Guardian Power
                    </div>
                    <div style="font-family: 'JetBrains Mono'; font-size: 32px; 
                                font-weight: 900; color: var(--purple); margin: 10px 0;">
                        <span id="mixer-shannon">3.82</span>
                    </div>

                    <div class="mixing-orb">
                        <div class="mixing-symbol">âŠ—</div>
                    </div>

                    <div class="tension-value" id="tension-display">1.0x</div>
                    <div class="tension-label">âš¡ HANDSHAKE TENSION</div>

                    <div class="formula-display">
                        T = [Insulin Ã— (CRP + 0.6) + TG/100 + Glc/100] / H'
                    </div>
                </div>

                <!-- Right: Verdict -->
                <div class="mixer-column">
                    <div class="panel-title">ğŸ¯ Status Report</div>
                    
                    <div class="status-badge" id="verdict-badge" 
                         style="background: var(--emerald); color: #000;">
                        SOVEREIGN
                    </div>

                    <div class="info-card" id="verdict-card" style="border-left-color: var(--emerald);">
                        <div class="card-title" id="verdict-title">âœ“ Perfect Sovereignty</div>
                        <p id="verdict-desc" style="margin-top: 10px; font-size: 13px;">
                            Your Guardian and blood markers are in perfect sync. 
                            No metabolic stress detected. System is sustainable.
                        </p>
                        <span class="arabic-text" id="verdict-arabic">
                            ØªÙ†Ø§ØºÙ… Ù…Ø«Ø§Ù„ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙˆÙ…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¯Ù…. Ù†Ø¸Ø§Ù… Ù…Ø³ØªØ¯Ø§Ù….
                        </span>
                    </div>

                    <div class="info-card" style="border-left-color: var(--rose); margin-top: 20px;">
                        <span class="card-icon">âš ï¸</span>
                        <div class="card-title">The Double Hit Danger</div>
                        <strong>Scenario 1:</strong> Bad gut + bad blood = Everyone knows you're sick<br>
                        <strong>Scenario 2:</strong> Good gut + bad blood = Your gut is exhausted compensating<br>
                        <strong>Scenario 3:</strong> Bad gut + "normal" blood = <span style="color: var(--rose); font-weight: 900;">
                            SILENT KILLER â˜ ï¸
                        </span>
                        <br><br>
                        Doctors miss #3 because they only check blood. We catch it.
                        <span class="arabic-text">
                            Ø§Ù„Ø£Ù…Ø¹Ø§Ø¡ Ø§Ù„Ø³ÙŠØ¦Ø© + ØªØ­Ø§Ù„ÙŠÙ„ "Ø·Ø¨ÙŠØ¹ÙŠØ©" = Ø§Ù„Ù‚Ø§ØªÙ„ Ø§Ù„ØµØ§Ù…Øª Ø§Ù„Ø°ÙŠ ÙŠØªØ¬Ø§Ù‡Ù„Ù‡ Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡
                        </span>
                    </div>
                </div>
            </div>

            <button class="btn-mega" onclick="nextPhase(3)" style="margin-top: 50px;">
                <span>ğŸ“ˆ View Your 20-Year Trajectory â†’ Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</span>
            </button>
        </section>

        <!-- PHASE 3: INTERACTIVE GRAPH -->
        <section class="stage" id="phase-3">
            <div class="graph-container">
                <div class="graph-header">
                    <div class="graph-title">
                        <h2>ğŸ“Š Your 20-Year Biological Debt</h2>
                        <div class="graph-subtitle">Ø§Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ù„Ù…Ø¯Ø© Ø¹Ø´Ø±ÙŠÙ† Ø¹Ø§Ù…Ø§Ù‹</div>
                    </div>
                    <div class="status-badge" id="graph-zone-badge" 
                         style="background: var(--emerald); color: #000;">
                        ğŸ›¡ï¸ SOVEREIGN ZONE
                    </div>
                </div>

                <svg class="svg-graph" id="trajectory-svg" viewBox="0 0 900 500">
                    <!-- Grid Lines -->
                    <defs>
                        <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
                            <path d="M 50 0 L 0 0 0 50" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="1"/>
                        </pattern>
                    </defs>
                    <rect width="900" height="500" fill="url(#grid)" />

                    <!-- Baseline -->
                    <line x1="0" y1="450" x2="900" y2="450" stroke="rgba(255,255,255,0.1)" 
                          stroke-width="2" stroke-dasharray="10,5"></line>
                    
                    <!-- Trajectory Curve -->
                    <path id="trajectory-path" fill="none" stroke="rgba(255,255,255,0.08)" 
                          stroke-width="10" d="M 0 450 Q 225 450, 450 250 T 900 50" opacity="0.6"></path>
                    
                    <!-- Your Position -->
                    <circle id="your-dot" class="marker-dot" cx="150" cy="420" r="20" 
                            fill="currentColor" stroke="rgba(0,0,0,0.4)" stroke-width="4"
                            style="color: var(--emerald);"></circle>
                    
                    <!-- Label -->
                    <text id="dot-label" x="180" y="410" 
                          style="fill:#fff; font-size:22px; font-weight:900; font-family:'JetBrains Mono';">
                        YOU: 1.0x
                    </text>

                    <!-- Zone Backgrounds -->
                    <rect x="0" y="0" width="300" height="500" fill="rgba(16, 185, 129, 0.08)" rx="20"></rect>
                    <text x="100" y="485" style="fill:var(--emerald); font-size:13px; font-weight:900;">
                        âœ“ SOVEREIGN
                    </text>

                    <rect x="300" y="0" width="300" height="500" fill="rgba(245, 158, 11, 0.08)" rx="20"></rect>
                    <text x="410" y="485" style="fill:var(--amber); font-size:13px; font-weight:900;">
                        âš ï¸ DRIFT
                    </text>

                    <rect x="600" y="0" width="300" height="500" fill="rgba(239, 68, 68, 0.08)" rx="20"></rect>
                    <text x="720" y="485" style="fill:var(--rose); font-size:13px; font-weight:900;">
                        â˜ ï¸ FAILURE
                    </text>

                    <!-- Axis Labels -->
                    <text x="10" y="30" style="fill:var(--text-muted); font-size:12px; font-weight:800;">
                        High Risk
                    </text>
                    <text x="10" y="490" style="fill:var(--text-muted); font-size:12px; font-weight:800;">
                        Low Risk
                    </text>
                    <text x="850" y="490" style="fill:var(--text-muted); font-size:12px; font-weight:800;">
                        20 Years â†’
                    </text>
                </svg>

                <div class="zone-grid">
                    <div class="zone-card" style="border-color: var(--emerald);">
                        <span class="zone-icon" style="color: var(--emerald);">ğŸ›¡ï¸</span>
                        <div class="zone-title" style="color: var(--emerald);">Sovereign Zone</div>
                        <div class="zone-desc">
                            <strong>T < 2.0</strong><br>
                            Your body's math is working <em>for you</em>, not against you. 
                            Minimal computational load. Sustainable for decades. 
                            The preventative window is wide open.
                        </div>
                    </div>

                    <div class="zone-card" style="border-color: var(--amber);">
                        <span class="zone-icon" style="color: var(--amber);">âš ï¸</span>
                        <div class="zone-title" style="color: var(--amber);">Metabolic Drift</div>
                        <div class="zone-desc">
                            <strong>T: 2.0-4.0</strong><br>
                            Your Guardian is losing its grip on the metabolic gates. 
                            Vascular damage starting. Intervention window narrowing fast. 
                            This is the "pre-disease" zone doctors miss.
                        </div>
                    </div>

                    <div class="zone-card" style="border-color: var(--rose);">
                        <span class="zone-icon" style="color: var(--rose);">â˜ ï¸</span>
                        <div class="zone-title" style="color: var(--rose);">Failure Zone</div>
                        <div class="zone-desc">
                            <strong>T > 4.0</strong><br>
                            Structural tissue damage is <em>active</em>. 
                            Nerve endings dying from oxygen starvation. 
                            High necrotic risk. Emergency intervention required now.
                        </div>
                    </div>
                </div>

                <div class="info-card" style="border-left-color: var(--purple); margin-top: 40px;">
                    <span class="card-icon">ğŸ§ </span>
                    <div class="card-title">What This Graph Actually Means</div>
                    Your dot's position = the <strong>computational burden</strong> your microbiome carries 
                    to keep you metabolically stable.<br><br>
                    
                    <strong>Think of it like this:</strong><br>
                    â€¢ <strong>Left side (Sovereign):</strong> Your body is on cruise control, using 20% CPU<br>
                    â€¢ <strong>Middle (Drift):</strong> Your body is at 80% CPU, starting to lag<br>
                    â€¢ <strong>Right side (Failure):</strong> Your body crashed â€” the blue screen of death
                    
                    <span class="arabic-text" style="margin-top: 15px;">
                        Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ù‚Ø·Ø© = Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ Ø§Ù„Ø°ÙŠ ØªØ­Ù…Ù„Ù‡ Ø£Ù…Ø¹Ø§Ø¦Ùƒ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø£ÙŠØ¶ÙŠ.
                        Ø§Ù„ÙŠØ³Ø§Ø± = Ù…Ø³ØªØ¯Ø§Ù…. Ø§Ù„ÙˆØ³Ø· = Ù…ØªØ¯Ù‡ÙˆØ±. Ø§Ù„ÙŠÙ…ÙŠÙ† = Ù…Ù†Ù‡Ø§Ø±.
                    </span>
                </div>
            </div>

            <button class="btn-mega" onclick="nextPhase(4)" style="margin-top: 50px;">
                <span>âš ï¸ Deep Dive: Gangrene Risk Analysis â†’ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ‚</span>
            </button>
        </section>

        <!-- PHASE 4: GANGRENE DEEP DIVE -->
        <section class="stage" id="phase-4">
            <div class="gangrene-report">
                <div class="report-grid">
                    <!-- Left: Risk Score -->
                    <div>
                        <div class="risk-display">
                            <div class="risk-icon">âš ï¸</div>
                            <div class="risk-score" id="final-risk">18%</div>
                            <div class="risk-label">20-YEAR GANGRENE PROBABILITY</div>
                        </div>

                        <div class="metrics-grid">
                            <div class="metric-box">
                                <div class="metric-label">ğŸ«€ Nerve Oxygen</div>
                                <div class="metric-value" id="metric-oxygen" style="color: var(--emerald);">
                                    98%
                                </div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-label">âš¡ Your Tension</div>
                                <div class="metric-value" id="metric-tension" style="color: var(--blue);">
                                    1.0x
                                </div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-label">ğŸ›¡ï¸ Guardian Power</div>
                                <div class="metric-value" id="metric-shannon" style="color: var(--purple);">
                                    3.82
                                </div>
                            </div>
                            <div class="metric-box">
                                <div class="metric-label">ğŸ“Š Status</div>
                                <div class="metric-value" id="metric-status" style="font-size: 20px; color: var(--emerald);">
                                    SAFE
                                </div>
                            </div>
                        </div>

                        <div class="gcc-context">
                            <div class="gcc-icon">ğŸŒ</div>
                            <div class="gcc-title">ğŸ”¥ Why GCC is Different</div>
                            <div class="gcc-desc">
                                <strong>Ambient heat (45Â°C+)</strong> + <strong>High date/sugar diet</strong> = 
                                Accelerated glycation of blood vessels (think of it like caramelizing sugar in a pan).
                                <br><br>
                                When your Guardian (Akkermansia) is weak, this process happens <strong>3x faster</strong> 
                                in GCC populations. Your nerves start dying silently from oxygen starvation.
                                <br><br>
                                <em>Source: Middle East Journal of Internal Medicine, 2023</em>
                            </div>
                            <span class="arabic-text">
                                Ø§Ù„Ø­Ø±Ø§Ø±Ø© + Ø§Ù„Ø³ÙƒØ±ÙŠØ§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© = ØªØ³Ø±ÙŠØ¹ ØªÙ„Ù Ø§Ù„Ø£ÙˆØ¹ÙŠØ© Ø§Ù„Ø¯Ù…ÙˆÙŠØ© 3 Ø£Ø¶Ø¹Ø§Ù Ø¹Ù†Ø¯ Ø¶Ø¹Ù Ø§Ù„Ù…Ø­Ø§ÙØ¸
                            </span>
                        </div>
                    </div>

                    <!-- Right: Mechanism -->
                    <div class="pathology-section">
                        <h3>How Gangrene Actually Starts</h3>
                        <p style="font-size: 14px; line-height: 1.8; color: #475569; margin-bottom: 30px;">
                            It's not sudden. It's a slow, mathematical process. Here's the <strong>exact mechanism</strong>:
                        </p>

                        <div class="formula-breakdown">
                            <div class="formula-title">ğŸ§® The Math Behind Your Risk</div>
                            
                            <div class="formula-line">
                                <span class="formula-var">Step 1:</span> Handshake Tension (T) = 
                                [<span id="calc-insulin">4.2</span> Ã— (<span id="calc-crp">0.4</span> + 0.6) + 
                                <span id="calc-trig">110</span>/100 + <span id="calc-glc">88</span>/100] / 
                                <span id="calc-shannon">3.82</span>
                            </div>
                            
                            <div class="formula-line">
                                <span class="formula-var">Step 2:</span> T = <span class="formula-result" id="calc-result">1.0x</span>
                            </div>
                            
                            <div class="formula-line">
                                <span class="formula-var">Step 3:</span> Gangrene Risk = T Ã— 18% = 
                                <span class="formula-result" id="calc-final-risk">18%</span> over 20 years
                            </div>

                            <div style="margin-top: 20px; font-size: 12px; color: var(--text-muted); 
                                        padding: 15px; background: rgba(255,255,255,0.03); border-radius: 10px;">
                                ğŸ’¡ <strong>What this means:</strong> For every 1.0 increase in Tension, 
                                your 20-year gangrene risk increases by ~18%. At T=4.0, you're at 72% probability.
                            </div>
                        </div>

                        <div class="mechanism-steps">
                            <div class="step" style="border-left-color: var(--amber);">
                                <div class="step-number">01</div>
                                <div class="step-title" style="color: var(--amber);">
                                    ğŸ”¥ Chronic Inflammation (High CRP)
                                </div>
                                <div class="step-desc">
                                    Your blood vessels are under constant inflammatory attack. 
                                    Think of it like acid slowly dissolving the pipes in your house.
                                </div>
                            </div>

                            <div class="step" style="border-left-color: var(--rose);">
                                <div class="step-number">02</div>
                                <div class="step-title" style="color: var(--rose);">
                                    ğŸ©¸ Microvascular Rarefaction
                                </div>
                                <div class="step-desc">
                                    Your smallest blood vessels (capillaries) start disappearing. 
                                    Fewer vessels = less oxygen delivery to nerve endings in your feet and hands.
                                </div>
                            </div>

                            <div class="step" style="border-left-color: var(--purple);">
                                <div class="step-number">03</div>
                                <div class="step-title" style="color: var(--purple);">
                                    ğŸ’€ Silent Nerve Death (Neuropathy)
                                </div>
                                <div class="step-desc">
                                    Your nerves suffocate slowly. First you lose sensation (numbness). 
                                    Then comes pain. Then tissue death. This takes <strong>5-15 years</strong> 
                                    of high Tension â€” completely silent until it's too late.
                                </div>
                            </div>

                            <div class="step" style="border-left-color: #000;">
                                <div class="step-number">04</div>
                                <div class="step-title">
                                    â˜ ï¸ Tissue Necrosis (Gangrene)
                                </div>
                                <div class="step-desc">
                                    Dead nerves + poor circulation = tissue death. 
                                    A small cut that won't heal becomes infected. Infection spreads. 
                                    Result: <strong>Amputation</strong>. This is the <em>mathematical endpoint</em> 
                                    of uncontrolled high Tension.
                                </div>
                            </div>
                        </div>

                        <div class="evidence-pills">
                            <div class="evidence-pill">ğŸ“„ Nature Metabolism 2023</div>
                            <div class="evidence-pill">ğŸ“„ Cell Reports Med 2022</div>
                            <div class="evidence-pill">ğŸ“„ Lancet Diabetes 2024</div>
                            <div class="evidence-pill">ğŸ“„ J. Clin. Invest. 2024</div>
                            <div class="evidence-pill">ğŸ“„ MEJIM 2023 (GCC Study)</div>
                        </div>

                        <div class="info-card" style="border-left-color: var(--cyan); 
                                                     background: #e0f2fe; margin-top: 30px;">
                            <span class="card-icon" style="color: var(--cyan);">ğŸ’Š</span>
                            <div class="card-title" style="color: #0c4a6e;">The Good News</div>
                            <div style="color: #075985; font-size: 14px; line-height: 1.8;">
                                This is <strong>100% preventable</strong> if caught early (T < 2.0). 
                                The interventions are simple:<br><br>
                                
                                â€¢ <strong>Boost Akkermansia:</strong> Polyphenols (berries, green tea), 
                                  omega-3s, intermittent fasting<br>
                                â€¢ <strong>Lower inflammation:</strong> Remove processed foods, 
                                  improve sleep, manage stress<br>
                                â€¢ <strong>Optimize insulin:</strong> Resistance training, 
                                  reduce refined carbs<br><br>
                                
                                The window is open. The math can be reversed. But you have to act <em>before</em> 
                                your labs look bad.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer style="padding: 30px; text-align: center; opacity: 0.7; 
                       font-size: 11px; font-family: 'JetBrains Mono'; 
                       letter-spacing: 1px; margin-top: 50px;">
            ğŸ›¡ï¸ AL-MOHAFIZ | BURAK CORE SYSTEM | REGION: GCC<br>
            <span style="color: var(--amber); font-weight: 700; margin-top: 8px; display: inline-block;">
                Developed by Waseem Ahanger
            </span>
        </footer>
        
        <!-- Computing Overlay -->
        <div id="compute-overlay" style="
            position: fixed; inset: 0; z-index: 9999;
            background: rgba(5, 7, 10, 0.98);
            backdrop-filter: blur(20px);
            display: none; align-items: center; justify-content: center;
            flex-direction: column; gap: 30px;">
            
            <div style="text-align: center;">
                <!-- Spinning Engine Icon -->
                <div style="width: 120px; height: 120px; margin: 0 auto 30px;
                            background: linear-gradient(135deg, var(--emerald), var(--cyan));
                            border-radius: 30px; display: flex; align-items: center; justify-content: center;
                            font-size: 60px; animation: spin 2s linear infinite;
                            box-shadow: 0 20px 60px rgba(16, 185, 129, 0.4);">
                    âš™ï¸
                </div>
                
                <!-- Computing Text -->
                <div style="font-size: 28px; font-weight: 900; color: var(--emerald);
                            margin-bottom: 15px; letter-spacing: 2px; text-transform: uppercase;">
                    MATH ENGINE COMPUTING
                </div>
                
                <!-- Computation Steps -->
                <div id="compute-steps-display" style="
                    font-family: 'JetBrains Mono'; font-size: 14px; color: var(--cyan);
                    text-align: left; background: rgba(0,0,0,0.4); padding: 25px 35px;
                    border-radius: 20px; border: 1px solid var(--border);
                    min-width: 500px; max-width: 600px;">
                    <div class="compute-line" style="margin: 8px 0; opacity: 0;">
                        âœ“ Reading microbiome data...
                    </div>
                    <div class="compute-line" style="margin: 8px 0; opacity: 0;">
                        âœ“ Calculating Shannon Entropy...
                    </div>
                    <div class="compute-line" style="margin: 8px 0; opacity: 0;">
                        âœ“ Processing biomarkers...
                    </div>
                    <div class="compute-line" style="margin: 8px 0; opacity: 0;">
                        âœ“ Computing tension coefficient...
                    </div>
                    <div class="compute-line" style="margin: 8px 0; opacity: 0;">
                        âœ“ Analyzing trajectory...
                    </div>
                    <div class="compute-line" style="margin: 8px 0; opacity: 0;">
                        âœ“ Generating predictions...
                    </div>
                </div>
                
                <!-- Progress Bar -->
                <div style="width: 500px; height: 6px; background: rgba(255,255,255,0.1);
                            border-radius: 10px; overflow: hidden; margin-top: 30px;">
                    <div id="compute-progress" style="
                        height: 100%; width: 0%; 
                        background: linear-gradient(90deg, var(--emerald), var(--cyan));
                        transition: width 0.3s ease;
                        box-shadow: 0 0 20px var(--emerald);"></div>
                </div>
                
                <!-- Status Text -->
                <div id="compute-status" style="
                    margin-top: 20px; font-size: 13px; color: var(--text-muted);
                    font-family: 'JetBrains Mono';">
                    Initializing...
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let shannon = 3.82;
        let tension = 1.0;
        let currentPhase = 1;
        let erosionTimer = null;

        // Phase Navigation
        function nextPhase(p) {
            showComputeOverlay(p, () => {
                currentPhase = p;
                updatePhaseUI(p);
            });
        }

        function jumpPhase(p) {
            if (p <= currentPhase || p === 1) {
                showComputeOverlay(p, () => {
                    currentPhase = p;
                    updatePhaseUI(p);
                });
            }
        }
        
        // Show computing overlay with animation
        function showComputeOverlay(phase, callback) {
            const overlay = document.getElementById('compute-overlay');
            const progress = document.getElementById('compute-progress');
            const status = document.getElementById('compute-status');
            const lines = document.querySelectorAll('.compute-line');
            
            // Show overlay
            overlay.style.display = 'flex';
            
            // Reset
            progress.style.width = '0%';
            lines.forEach(line => line.style.opacity = '0');
            
            // Phase-specific computations
            const computations = {
                1: [
                    'Reading microbiome composition...',
                    'Calculating Shannon Entropy...',
                    'Evaluating diversity index...',
                    'Assessing barrier integrity...'
                ],
                2: [
                    'Loading biomarker data...',
                    'Processing insulin resistance...',
                    'Calculating inflammation markers...',
                    'Computing handshake tension...',
                    'Analyzing metabolic burden...'
                ],
                3: [
                    'Plotting trajectory curve...',
                    'Calculating 20-year projection...',
                    'Mapping risk zones...',
                    'Positioning current state...',
                    'Rendering graph visualization...'
                ],
                4: [
                    'Running comprehensive analysis...',
                    'Computing gangrene probability...',
                    'Calculating tissue oxygenation...',
                    'Modeling pathway mechanisms...',
                    'Generating risk assessment...',
                    'Preparing clinical report...'
                ]
            };
            
            const steps = computations[phase] || computations[1];
            const totalTime = 2000; // 2 seconds total
            const stepTime = totalTime / steps.length;
            
            // Animate computation steps
            steps.forEach((step, index) => {
                setTimeout(() => {
                    if (lines[index]) {
                        lines[index].textContent = 'âœ“ ' + step;
                        lines[index].style.opacity = '1';
                        lines[index].style.transition = 'opacity 0.3s ease';
                    }
                    
                    // Update progress
                    const progressPercent = ((index + 1) / steps.length) * 100;
                    progress.style.width = progressPercent + '%';
                    
                    // Update status
                    if (index === steps.length - 1) {
                        status.textContent = 'Complete!';
                    } else {
                        status.textContent = `Processing... ${Math.round(progressPercent)}%`;
                    }
                }, stepTime * index);
            });
            
            // Complete and hide
            setTimeout(() => {
                overlay.style.opacity = '0';
                overlay.style.transition = 'opacity 0.3s';
                setTimeout(() => {
                    overlay.style.display = 'none';
                    overlay.style.opacity = '1';
                    callback();
                }, 300);
            }, totalTime + 200);
        }

        function updatePhaseUI(p) {
            // Update stages
            document.querySelectorAll('.stage').forEach(s => s.classList.remove('active'));
            document.getElementById(`phase-${p}`).classList.add('active');
            
            // Update dots
            document.querySelectorAll('.nav-dot').forEach((d, i) => {
                d.classList.toggle('active', i === p - 1);
            });
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Execute phase-specific updates
            if (p === 2) mixHandshake();
            if (p === 3) updateGraph();
            if (p === 4) generateReport();
        }

        // Shannon Calculation
        function calcShannon() {
            const akk = parseInt(document.getElementById('slider-akk').value) / 100;
            const fae = parseInt(document.getElementById('slider-fae').value) / 100;
            const bac = parseInt(document.getElementById('slider-bac').value) / 100;
            const other = Math.max(0.01, 1 - (akk + fae + bac));
            
            const entropy = -(akk * Math.log(akk) + fae * Math.log(fae) + 
                             bac * Math.log(bac) + other * Math.log(other));
            shannon = (entropy * 3.2).toFixed(2);
            
            updateShannonUI();
        }

        function updateShannonUI() {
            // Update dial
            document.getElementById('shannon-display').innerText = shannon;
            document.getElementById('header-shannon').innerText = shannon;
            document.getElementById('mixer-shannon').innerText = shannon;
            
            // Update angle
            const angle = (parseFloat(shannon) / 5) * 360;
            document.getElementById('mega-dial').style.setProperty('--angle', `${angle}deg`);
            
            // Update color
            let color = 'var(--emerald)';
            let status = 'PROTECTIVE';
            if (shannon < 2.2) { color = 'var(--rose)'; status = 'COLLAPSED'; }
            else if (shannon < 3.2) { color = 'var(--amber)'; status = 'ERODING'; }
            
            
            document.documentElement.style.setProperty('--ring-color', color);
            document.getElementById('status-badge').innerText = status;
            document.getElementById('status-badge').style.background = color;
            
            // Update header Shannon color
            const shannonEl = document.getElementById('header-shannon');
            if (shannonEl) {
                shannonEl.style.color = color;
            } else {
                console.error('header-shannon element not found!');
            }
        }

        // Slider Handler
        function handleSlider() {
            const akk = parseInt(document.getElementById('slider-akk').value);
            const isBreached = akk < 6;
            
            // Update value display
            document.getElementById('val-akk').innerText = akk + '%';
            
            // Show/hide alert
            document.getElementById('alert-box').style.display = isBreached ? 'block' : 'none';
            
            // Handle erosion - FASTER for testing
            if (isBreached && !erosionTimer) {
                erosionTimer = setInterval(() => {
                    const currentAkk = parseInt(document.getElementById('slider-akk').value);
                    if (currentAkk < 6) {
                        const faeSlider = document.getElementById('slider-fae');
                        const bacSlider = document.getElementById('slider-bac');
                        
                        // Faster erosion: 1.0 instead of 0.2
                        faeSlider.value = Math.max(1, parseFloat(faeSlider.value) - 1.0);
                        bacSlider.value = Math.max(10, parseFloat(bacSlider.value) - 1.0);
                        
                        document.getElementById('val-fae').innerText = Math.round(faeSlider.value) + '%';
                        document.getElementById('val-bac').innerText = Math.round(bacSlider.value) + '%';
                        
                        calcShannon();
                    } else {
                        clearInterval(erosionTimer);
                        erosionTimer = null;
                    }
                }, 100);
            } else if (!isBreached && erosionTimer) {
                clearInterval(erosionTimer);
                erosionTimer = null;
            }
            
            calcShannon();
        }
        
        // TEST FUNCTION - Force Shannon to specific value
        window.testShannon = function(value) {
            shannon = value;
            updateShannonUI();
        }
        
        // TEST FUNCTION - Force Tension to specific value  
        window.testTension = function(value) {
            tension = value;
            const tensionEl = document.getElementById('header-tension');
            tensionEl.innerText = tension + 'x';
            document.getElementById('tension-display').innerText = tension + 'x';
            
            let tensionColor;
            if (tension < 2) {
                tensionColor = 'var(--emerald)';
            } else if (tension < 4) {
                tensionColor = 'var(--amber)';
            } else {
                tensionColor = 'var(--rose)';
            }
            tensionEl.style.color = tensionColor;
            document.getElementById('tension-display').style.color = tensionColor;
        }

        // Update other sliders
        document.getElementById('slider-fae').addEventListener('input', (e) => {
            document.getElementById('val-fae').innerText = e.target.value + '%';
            calcShannon();
        });
        document.getElementById('slider-bac').addEventListener('input', (e) => {
            document.getElementById('val-bac').innerText = e.target.value + '%';
            calcShannon();
        });

        // Handshake Mixer
        function mixHandshake() {
            const ins = parseFloat(document.getElementById('input-insulin').value) || 0;
            const crp = parseFloat(document.getElementById('input-crp').value) || 0;
            const trig = parseFloat(document.getElementById('input-trig').value) || 0;
            const glc = parseFloat(document.getElementById('input-glucose').value) || 0;
            
            tension = (((ins * (crp + 0.6)) + (trig / 100) + (glc / 100)) / parseFloat(shannon)).toFixed(2);
            
            
            // Update displays
            document.getElementById('tension-display').innerText = tension + 'x';
            const tensionEl = document.getElementById('header-tension');
            tensionEl.innerText = tension + 'x';
            
            // Dynamic tension color based on value
            let tensionColor;
            if (tension < 2) {
                tensionColor = 'var(--emerald)';
                tensionEl.style.color = tensionColor;
                document.getElementById('tension-display').style.color = tensionColor;
            } else if (tension < 4) {
                tensionColor = 'var(--amber)';
                tensionEl.style.color = tensionColor;
                document.getElementById('tension-display').style.color = tensionColor;
            } else {
                tensionColor = 'var(--rose)';
                tensionEl.style.color = tensionColor;
                document.getElementById('tension-display').style.color = tensionColor;
            }
            
            
            // Update verdict
            updateVerdict();
        }

        function updateVerdict() {
            const badge = document.getElementById('verdict-badge');
            const title = document.getElementById('verdict-title');
            const desc = document.getElementById('verdict-desc');
            const arabic = document.getElementById('verdict-arabic');
            const card = document.getElementById('verdict-card');
            
            if (tension < 1.8) {
                badge.style.background = 'var(--emerald)';
                badge.style.color = '#000';
                badge.innerText = 'âœ“ SOVEREIGN';
                title.innerText = 'âœ“ Perfect Sovereignty';
                desc.innerText = 'Your Guardian and blood markers are in perfect sync. No metabolic stress detected. System is sustainable for decades. Keep doing what you\'re doing.';
                arabic.innerText = 'ØªÙ†Ø§ØºÙ… Ù…Ø«Ø§Ù„ÙŠ. Ù†Ø¸Ø§Ù… Ù…Ø³ØªØ¯Ø§Ù…. Ø§Ø³ØªÙ…Ø± Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù†Ù‡Ø¬.';
                card.style.borderLeftColor = 'var(--emerald)';
            } else if (parseFloat(shannon) > 3.2 && tension > 2.5) {
                badge.style.background = 'var(--amber)';
                badge.style.color = '#000';
                badge.innerText = 'âš¡ EXHAUSTION';
                title.innerText = 'âš¡ Metabolic Exhaustion';
                desc.innerText = 'Your gut diversity is good, but your blood markers are elevated. This means your Guardian is working overtime to compensate for systemic dysfunction. It\'s like running your car engine at 8000 RPM on the highway â€” it works, but you\'re burning out.';
                arabic.innerText = 'Ø£Ù…Ø¹Ø§Ø¡ Ø¬ÙŠØ¯Ø© Ù„ÙƒÙ† Ù…Ø¤Ø´Ø±Ø§Øª Ø³ÙŠØ¦Ø©. Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙŠØ¹Ù…Ù„ Ø¨Ø¬Ù‡Ø¯ Ø²Ø§Ø¦Ø¯ ÙˆØ³ÙŠÙ†Ù‡Ø§Ø± Ù‚Ø±ÙŠØ¨Ø§Ù‹.';
                card.style.borderLeftColor = 'var(--amber)';
            } else if (parseFloat(shannon) < 2.5 && tension < 2.5) {
                badge.style.background = 'var(--amber)';
                badge.style.color = '#000';
                badge.innerText = 'ğŸ”‡ SILENT DRIFT';
                title.innerText = 'ğŸ”‡ Silent Metabolic Drift';
                desc.innerText = 'DANGER ZONE: Your blood markers look "okay" but your Guardian is weak. Your body is hiding damage through compensatory mechanisms. This is the silent killer doctors miss â€” normal labs, collapsing foundation.';
                arabic.innerText = 'Ù…Ù†Ø·Ù‚Ø© Ø®Ø·Ø±: Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª ØªØ¨Ø¯Ùˆ Ø·Ø¨ÙŠØ¹ÙŠØ© Ù„ÙƒÙ† Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø¶Ø¹ÙŠÙ. Ø®Ø·Ø± ØµØ§Ù…Øª Ù…Ø®ÙÙŠ.';
                card.style.borderLeftColor = 'var(--amber)';
            } else {
                badge.style.background = 'var(--rose)';
                badge.style.color = '#fff';
                badge.innerText = 'â˜ ï¸ CRITICAL';
                title.innerText = 'â˜ ï¸ Metabolic Insolvency';
                desc.innerText = 'RED ALERT: Guardian collapse + elevated inflammatory markers. Your body has run out of compensatory mechanisms. System failure is imminent. This is the pathway to diabetic complications, neuropathy, and gangrene. Immediate intervention required.';
                arabic.innerText = 'Ø¥Ù†Ø°Ø§Ø± Ø£Ø­Ù…Ø±: Ø§Ù†Ù‡ÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ù…Ø¹ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø§Ù„ØªÙ‡Ø§Ø¨. ÙØ´Ù„ Ù†Ø¸Ø§Ù…ÙŠ ÙˆØ´ÙŠÙƒ.';
                card.style.borderLeftColor = 'var(--rose)';
            }
            
            // Update tension color
            const tensionEl = document.getElementById('tension-display');
            if (tension < 2) tensionEl.style.color = 'var(--emerald)';
            else if (tension < 4) tensionEl.style.color = 'var(--amber)';
            else tensionEl.style.color = 'var(--rose)';
        }

        // Graph Update
        function updateGraph() {
            const dot = document.getElementById('your-dot');
            const label = document.getElementById('dot-label');
            const badge = document.getElementById('graph-zone-badge');
            
            // Calculate position
            const x = Math.min(880, parseFloat(tension) * 150);
            const y = 450 - (Math.pow(parseFloat(tension), 1.6) * 35);
            
            // Update position
            dot.setAttribute('cx', x);
            dot.setAttribute('cy', y);
            label.setAttribute('x', x + 30);
            label.setAttribute('y', y - 10);
            label.textContent = `YOU: ${tension}x`;
            
            // Update color and zone
            let color = 'var(--emerald)';
            let zoneText = 'ğŸ›¡ï¸ SOVEREIGN ZONE';
            
            if (tension < 2) {
                color = 'var(--emerald)';
                badge.style.background = 'var(--emerald)';
                badge.style.color = '#000';
            } else if (tension < 4) {
                color = 'var(--amber)';
                zoneText = 'âš ï¸ DRIFT ZONE';
                badge.style.background = 'var(--amber)';
                badge.style.color = '#000';
            } else {
                color = 'var(--rose)';
                zoneText = 'â˜ ï¸ FAILURE ZONE';
                badge.style.background = 'var(--rose)';
                badge.style.color = '#fff';
            }
            
            badge.innerText = zoneText;
            dot.style.color = color;
        }

        // Generate Report
        function generateReport() {
            const risk = Math.min(99, parseFloat(tension) * 18).toFixed(0);
            
            // Update risk score
            document.getElementById('final-risk').innerText = risk + '%';
            
            // Update metrics
            const oxygenation = tension > 2 ? Math.max(0, 100 - (risk * 0.65)).toFixed(0) : 100;
            document.getElementById('metric-oxygen').innerText = oxygenation + '%';
            document.getElementById('metric-tension').innerText = tension + 'x';
            document.getElementById('metric-shannon').innerText = shannon;
            
            // Update status
            const statusEl = document.getElementById('metric-status');
            if (tension < 2) {
                statusEl.innerText = 'SAFE';
                statusEl.style.color = 'var(--emerald)';
            } else if (tension < 4) {
                statusEl.innerText = 'AT RISK';
                statusEl.style.color = 'var(--amber)';
            } else {
                statusEl.innerText = 'DANGER';
                statusEl.style.color = 'var(--rose)';
            }
            
            // Update calculation display
            document.getElementById('calc-insulin').innerText = document.getElementById('input-insulin').value;
            document.getElementById('calc-crp').innerText = document.getElementById('input-crp').value;
            document.getElementById('calc-trig').innerText = document.getElementById('input-trig').value;
            document.getElementById('calc-glc').innerText = document.getElementById('input-glucose').value;
            document.getElementById('calc-shannon').innerText = shannon;
            document.getElementById('calc-result').innerText = tension + 'x';
            document.getElementById('calc-final-risk').innerText = risk + '%';
            
            // Update colors
            const riskEl = document.getElementById('final-risk');
            const oxyEl = document.getElementById('metric-oxygen');
            
            if (tension < 2) {
                riskEl.style.color = 'var(--emerald)';
                oxyEl.style.color = 'var(--emerald)';
            } else {
                riskEl.style.color = '#dc2626';
                oxyEl.style.color = '#dc2626';
            }
        }

        // Reset
        function resetDemo() {
            if (confirm('Reset all values and start over?')) {
                
                // Reset sliders
                document.getElementById('slider-akk').value = 12;
                document.getElementById('slider-fae').value = 15;
                document.getElementById('slider-bac').value = 36;
                
                // Reset inputs
                document.getElementById('input-insulin').value = 4.2;
                document.getElementById('input-crp').value = 0.4;
                document.getElementById('input-glucose').value = 88;
                document.getElementById('input-trig').value = 110;
                
                // Reset displays
                document.getElementById('val-akk').innerText = '12%';
                document.getElementById('val-fae').innerText = '15%';
                document.getElementById('val-bac').innerText = '36%';
                
                // Recalculate
                calcShannon();
                mixHandshake();
                
                // Return to phase 1
                nextPhase(1);
                
                // Success message
                setTimeout(() => {
                    alert('âœ“ Reset complete! Shannon: ' + shannon + ', Tension: ' + tension + 'x');
                }, 500);
            } else {
            }
        }

        // Initialize
        window.onload = () => {
            // Set initial badge colors
            document.getElementById('header-shannon').style.color = 'var(--emerald)';
            document.getElementById('header-tension').style.color = 'var(--emerald)';
            
            calcShannon();
            mixHandshake();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight' && currentPhase < 4) nextPhase(currentPhase + 1);
                if (e.key === 'ArrowLeft' && currentPhase > 1) nextPhase(currentPhase - 1);
            });
        };
    </script>
</body>
</html>

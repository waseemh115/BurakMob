<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ramadan Co-Pilot | BURAK Engine v2.0 PRO</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#050508;--bg2:#0a0a12;--card:#0d0d18;--card2:#12121f;--el:#181828;--border:#252540;--border2:#353560;--cyan:#00d4ff;--emerald:#00ff88;--amber:#ffb800;--rose:#ff3366;--purple:#9945ff;--gold:#ffd700;--text:#f0f4ff;--dim:#a0a8c0;--muted:#606880}
body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;font-size:14px}
.bg-effects{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:0}
.bg-orb{position:absolute;border-radius:50%;filter:blur(100px);opacity:0.12;animation:float 20s ease-in-out infinite}
.bg-orb.o1{width:500px;height:500px;background:var(--cyan);top:-200px;left:-200px}
.bg-orb.o2{width:400px;height:400px;background:var(--purple);bottom:-150px;right:-150px;animation-delay:-7s}
@keyframes float{0%,100%{transform:translate(0,0)}50%{transform:translate(30px,30px)}}
.top-nav{position:sticky;top:0;z-index:100;background:rgba(5,5,8,0.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:12px 20px}
.top-inner{max-width:1800px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:10px}
.brand-icon{width:44px;height:44px;background:linear-gradient(135deg,var(--gold),var(--amber));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:22px}
.brand h1{font-size:16px;background:linear-gradient(90deg,var(--gold),var(--amber));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.brand span{font-size:9px;color:var(--purple);display:block}
.top-stats{display:flex;gap:10px}
.top-stat{background:var(--el);border:1px solid var(--border);border-radius:8px;padding:8px 14px;text-align:center;min-width:80px}
.top-stat-val{font-size:16px;font-weight:700}
.top-stat-val.pos{color:var(--emerald)}
.top-stat-val.neg{color:var(--rose)}
.top-stat-lbl{font-size:8px;color:var(--muted);margin-top:2px;text-transform:uppercase}
.mode-ind{display:flex;align-items:center;gap:6px;padding:8px 14px;border-radius:8px;font-size:12px;font-weight:600}
.mode-ind.deficit{background:rgba(0,255,136,0.1);border:1px solid var(--emerald);color:var(--emerald)}
.mode-ind.surplus{background:rgba(255,51,102,0.1);border:1px solid var(--rose);color:var(--rose)}
.mode-ind .dot{width:6px;height:6px;border-radius:50%;animation:pulse 2s infinite}
.mode-ind.deficit .dot{background:var(--emerald)}
.mode-ind.surplus .dot{background:var(--rose)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
.main{display:grid;grid-template-columns:380px 1fr;min-height:calc(100vh - 70px);position:relative;z-index:1}
@media(max-width:1000px){.main{grid-template-columns:1fr}}
.panel{background:var(--card);border-right:1px solid var(--border);padding:20px;overflow-y:auto;max-height:calc(100vh - 70px)}
.section{margin-bottom:20px}
.sec-head{display:flex;align-items:center;gap:8px;margin-bottom:12px}
.sec-icon{width:28px;height:28px;background:var(--el);border:1px solid var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px}
.sec-title{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px}
.sec-badge{font-size:8px;padding:2px 6px;background:var(--purple);color:#fff;border-radius:3px}
.input-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
.input-card{background:var(--el);border:2px solid var(--border);border-radius:10px;padding:12px;transition:all 0.3s}
.input-card:focus-within{border-color:var(--cyan)}
.input-card input{width:100%;background:transparent;border:none;font-size:24px;font-weight:700;color:var(--text);text-align:center}
.input-card input:focus{outline:none}
.input-card label{display:block;font-size:9px;color:var(--muted);text-align:center;margin-top:4px;text-transform:uppercase}
.slider-card{background:var(--el);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px}
.slider-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.slider-info .lbl{font-size:11px;color:var(--dim)}
.slider-info .sub{font-size:9px;color:var(--muted)}
.slider-val{font-size:28px;font-weight:700}
.slider-val.cal{color:var(--amber)}
.slider-val.fast{color:var(--cyan)}
.slider-val .unit{font-size:11px;color:var(--muted)}
.slider-track{height:6px;background:var(--border);border-radius:3px;margin-bottom:6px;position:relative}
.slider-fill{position:absolute;height:100%;border-radius:3px}
.slider-fill.cal{background:linear-gradient(90deg,#cc9300,var(--amber))}
.slider-fill.fast{background:linear-gradient(90deg,#00a8cc,var(--cyan))}
input[type=range]{width:100%;height:6px;-webkit-appearance:none;background:transparent;margin-top:-6px;position:relative;z-index:2}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;background:var(--text);border-radius:50%;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.3)}
.slider-marks{display:flex;justify-content:space-between;font-size:8px;color:var(--muted)}
.act-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.act-btn{padding:10px 6px;background:var(--el);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center;transition:all 0.3s}
.act-btn:hover{border-color:var(--border2)}
.act-btn.active{border-color:var(--gold);background:rgba(255,215,0,0.1)}
.act-btn .ico{font-size:18px}
.act-btn .name{font-size:9px;font-weight:600;color:var(--dim);margin-top:2px}
.act-btn.active .name{color:var(--gold)}
.act-btn .mult{font-size:7px;color:var(--muted)}
.flags{display:flex;gap:6px;margin-top:10px}
.flag{flex:1;padding:10px;background:var(--el);border:2px solid var(--border);border-radius:8px;cursor:pointer;text-align:center;transition:all 0.3s}
.flag.active{border-color:var(--rose);background:rgba(255,51,102,0.1)}
.flag .ico{font-size:14px}
.flag .txt{font-size:8px;color:var(--dim);margin-top:2px}
.flag.active .txt{color:var(--rose)}
.summary{background:var(--card2);border:2px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px;position:relative;overflow:hidden}
.summary::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.summary.deficit::before{background:linear-gradient(90deg,var(--emerald),var(--cyan))}
.summary.surplus::before{background:linear-gradient(90deg,var(--rose),var(--amber))}
.sum-eq{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:12px;flex-wrap:wrap}
.sum-term{text-align:center}
.sum-term .val{font-size:24px;font-weight:700}
.sum-term .val.burn{color:var(--cyan)}
.sum-term .val.eat{color:var(--amber)}
.sum-term .val.gap{color:var(--emerald)}
.sum-term .val.excess{color:var(--rose)}
.sum-term .lbl{font-size:8px;color:var(--muted);text-transform:uppercase}
.sum-op{font-size:18px;color:var(--muted)}
.sum-msg{text-align:center;padding:10px 12px;border-radius:8px;font-size:11px;font-weight:600}
.sum-msg.good{background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3);color:var(--emerald)}
.sum-msg.bad{background:rgba(255,51,102,0.1);border:1px solid rgba(255,51,102,0.3);color:var(--rose)}
.calc-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--gold),var(--amber));border:none;border-radius:12px;font-size:14px;font-weight:700;color:#000;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:8px}
.calc-btn:hover{transform:translateY(-2px);box-shadow:0 0 30px rgba(255,215,0,0.3)}
.dash{padding:20px;overflow-y:auto;max-height:calc(100vh - 70px);background:linear-gradient(135deg,var(--bg),var(--bg2))}
.welcome{text-align:center;padding:60px 30px;max-width:450px;margin:0 auto}
.welcome-icon{width:80px;height:80px;background:linear-gradient(135deg,var(--gold),var(--purple));border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:40px;margin:0 auto 20px}
.welcome h2{font-size:24px;margin-bottom:10px}
.welcome p{font-size:13px;color:var(--dim);line-height:1.5}
.welcome-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:24px;text-align:left}
.welcome-feat{background:var(--el);border:1px solid var(--border);border-radius:10px;padding:14px}
.welcome-feat .ico{font-size:20px;margin-bottom:6px}
.welcome-feat .title{font-size:11px;font-weight:600}
.welcome-feat .desc{font-size:9px;color:var(--muted)}
.res-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px}
.res-title{font-size:20px;font-weight:700}
.day-sel{display:flex;align-items:center;gap:10px;background:var(--el);border:1px solid var(--border);border-radius:10px;padding:8px 14px}
.day-sel label{font-size:10px;color:var(--muted)}
.day-sel input{width:120px}
.day-badge{background:linear-gradient(135deg,var(--gold),var(--amber));padding:6px 12px;border-radius:6px;font-weight:700;color:#000;font-size:13px}
.state-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
.state-head{font-size:12px;font-weight:700;color:var(--purple);margin-bottom:12px;display:flex;align-items:center;gap:6px}
.state-head::before{content:'';width:3px;height:14px;background:var(--purple);border-radius:2px}
.state-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
@media(max-width:700px){.state-grid{grid-template-columns:repeat(3,1fr)}}
.state-item{background:var(--el);border:1px solid var(--border);border-radius:10px;padding:12px;text-align:center;cursor:pointer;transition:all 0.3s}
.state-item:hover{transform:translateY(-2px);border-color:var(--border2)}
.state-item .ico{font-size:20px;margin-bottom:6px}
.state-item .val{font-size:18px;font-weight:700}
.state-item .val.good{color:var(--emerald)}
.state-item .val.bad{color:var(--rose)}
.state-item .lbl{font-size:8px;color:var(--muted);margin-top:2px;text-transform:uppercase}
.cascade-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
.cascade-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.cascade-title{font-size:12px;font-weight:700;color:var(--cyan);display:flex;align-items:center;gap:6px}
.cascade-title::before{content:'';width:3px;height:14px;background:var(--cyan);border-radius:2px}
.cascade-legend{display:flex;gap:12px;font-size:9px;color:var(--muted)}
.cascade-legend span{display:flex;align-items:center;gap:3px}
.cascade-legend .dot{width:6px;height:6px;border-radius:50%}
.cascade-legend .dot.good{background:var(--emerald)}
.cascade-legend .dot.bad{background:var(--rose)}
.cascade-flow{display:flex;flex-direction:column;gap:3px}
.casc-step{display:grid;grid-template-columns:36px 1fr 100px 70px;align-items:center;gap:10px;padding:12px;background:var(--el);border-radius:10px;border-left:3px solid var(--border);cursor:pointer;transition:all 0.3s}
.casc-step:hover{background:var(--card2);transform:translateX(3px)}
.casc-step.good{border-left-color:var(--emerald)}
.casc-step.bad{border-left-color:var(--rose)}
.casc-num{width:24px;height:24px;background:var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700}
.casc-step.good .casc-num{background:rgba(0,255,136,0.2);color:var(--emerald)}
.casc-step.bad .casc-num{background:rgba(255,51,102,0.2);color:var(--rose)}
.casc-info{min-width:0}
.casc-name{font-size:12px;font-weight:600;display:flex;align-items:center;gap:6px}
.casc-formula{font-size:8px;color:var(--purple);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.casc-bar{height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.casc-fill{height:100%;border-radius:3px}
.casc-fill.good{background:linear-gradient(90deg,#00cc6a,var(--emerald))}
.casc-fill.bad{background:linear-gradient(90deg,#cc2952,var(--rose))}
.casc-val{font-size:14px;font-weight:700;text-align:right}
.casc-val.good{color:var(--emerald)}
.casc-val.bad{color:var(--rose)}
.casc-arrow{text-align:center;color:var(--border2);font-size:10px;padding:1px 0}
.deep-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px}
@media(max-width:800px){.deep-grid{grid-template-columns:1fr}}
.deep-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;position:relative;overflow:hidden}
.deep-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.deep-card.insulin::before{background:linear-gradient(90deg,var(--purple),var(--cyan))}
.deep-card.liver::before{background:linear-gradient(90deg,var(--amber),var(--rose))}
.deep-card.gut::before{background:linear-gradient(90deg,var(--emerald),var(--cyan))}
.deep-card.inflammation::before{background:linear-gradient(90deg,var(--rose),var(--purple))}
.deep-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
.deep-title{display:flex;align-items:center;gap:8px}
.deep-title .ico{width:36px;height:36px;background:var(--el);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px}
.deep-title h3{font-size:13px;font-weight:700}
.deep-title span{font-size:9px;color:var(--muted);display:block}
.deep-value .num{font-size:24px;font-weight:700}
.deep-value .num.good{color:var(--emerald)}
.deep-value .num.bad{color:var(--rose)}
.deep-value .unit{font-size:10px;color:var(--muted)}
.deep-gauge{height:6px;background:var(--border);border-radius:3px;margin-bottom:12px;position:relative;overflow:hidden}
.deep-gauge-marker{position:absolute;top:-3px;bottom:-3px;width:3px;background:var(--text);border-radius:2px}
.deep-metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px}
.deep-metric{background:var(--el);border-radius:6px;padding:8px;text-align:center}
.deep-metric .v{font-size:12px;font-weight:700}
.deep-metric .v.good{color:var(--emerald)}
.deep-metric .v.bad{color:var(--rose)}
.deep-metric .l{font-size:7px;color:var(--muted);margin-top:1px;text-transform:uppercase}
.deep-insight{background:var(--el);border-radius:8px;padding:12px}
.deep-insight-title{font-size:9px;font-weight:700;color:var(--cyan);margin-bottom:6px;text-transform:uppercase}
.deep-insight-text{font-size:10px;color:var(--dim);line-height:1.5}
.deep-insight-text strong{color:var(--text)}
.disease-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
.disease-head{font-size:12px;font-weight:700;color:var(--rose);margin-bottom:12px;display:flex;align-items:center;gap:6px}
.disease-head::before{content:'';width:3px;height:14px;background:var(--rose);border-radius:2px}
.disease-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
@media(max-width:600px){.disease-grid{grid-template-columns:repeat(2,1fr)}}
.dis-item{background:var(--el);border:2px solid var(--border);border-radius:12px;padding:14px;text-align:center;cursor:pointer;transition:all 0.3s}
.dis-item:hover{transform:translateY(-3px)}
.dis-item.good{border-color:var(--emerald);background:rgba(0,255,136,0.05)}
.dis-item.bad{border-color:var(--rose);background:rgba(255,51,102,0.05)}
.dis-item .ico{font-size:28px;margin-bottom:8px}
.dis-item .name{font-size:9px;font-weight:600;color:var(--dim);margin-bottom:6px;text-transform:uppercase}
.dis-item .val{font-size:20px;font-weight:700}
.dis-item .val.good{color:var(--emerald)}
.dis-item .val.bad{color:var(--rose)}
.dis-item .trend{font-size:9px;margin-top:4px;padding:3px 6px;border-radius:3px;display:inline-block}
.dis-item .trend.good{background:rgba(0,255,136,0.2);color:var(--emerald)}
.dis-item .trend.bad{background:rgba(255,51,102,0.2);color:var(--rose)}
.story-card{background:linear-gradient(135deg,var(--card),var(--card2));border:2px solid var(--gold);border-radius:14px;padding:20px;margin-bottom:16px;position:relative;overflow:hidden}
.story-card::after{content:'üåô';position:absolute;top:16px;right:16px;font-size:50px;opacity:0.1}
.story-head{font-size:14px;font-weight:700;color:var(--gold);margin-bottom:12px}
.story-text{font-size:12px;line-height:1.7;color:var(--dim)}
.story-text strong{color:var(--text)}
.story-text .hl{color:var(--emerald);font-weight:600}
.story-text .warn{color:var(--rose);font-weight:600}
.report-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:16px}
.report-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px}
.report-title{font-size:12px;font-weight:700;color:var(--amber);display:flex;align-items:center;gap:6px}
.report-title::before{content:'';width:3px;height:14px;background:var(--amber);border-radius:2px}
.report-btns{display:flex;gap:6px}
.report-btn{padding:8px 12px;background:var(--el);border:1px solid var(--border);border-radius:6px;font-size:10px;font-weight:600;color:var(--dim);cursor:pointer;transition:all 0.3s}
.report-btn:hover{border-color:var(--border2);color:var(--text)}
.report-btn.primary{background:linear-gradient(135deg,var(--amber),var(--gold));color:#000;border:none}
.report-summary{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px}
@media(max-width:550px){.report-summary{grid-template-columns:1fr}}
.rpt-card{background:var(--el);border-radius:10px;padding:14px}
.rpt-card-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.rpt-card-title{font-size:10px;color:var(--muted);text-transform:uppercase}
.rpt-card-badge{font-size:8px;padding:2px 6px;border-radius:3px;font-weight:600}
.rpt-card-badge.good{background:rgba(0,255,136,0.2);color:var(--emerald)}
.rpt-card-badge.bad{background:rgba(255,51,102,0.2);color:var(--rose)}
.rpt-card-val{font-size:28px;font-weight:700;margin-bottom:2px}
.rpt-card-val.good{color:var(--emerald)}
.rpt-card-val.bad{color:var(--rose)}
.rpt-card-desc{font-size:9px;color:var(--muted)}
.report-recs{background:var(--el);border-radius:10px;padding:14px}
.recs-title{font-size:10px;font-weight:700;color:var(--cyan);margin-bottom:10px;text-transform:uppercase}
.recs-list{display:flex;flex-direction:column;gap:6px}
.rec-item{display:flex;gap:8px;padding:8px;background:var(--card);border-radius:6px}
.rec-item .ico{width:24px;height:24px;background:var(--el);border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}
.rec-item .txt{font-size:10px;color:var(--dim);line-height:1.4}
.rec-item .txt strong{color:var(--text)}
.modal-bg{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;z-index:200;opacity:0;pointer-events:none;transition:opacity 0.3s;backdrop-filter:blur(10px)}
.modal-bg.show{opacity:1;pointer-events:all}
.modal{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;max-width:480px;width:90%;max-height:80vh;overflow-y:auto}
.modal.good{border-color:var(--emerald)}
.modal.bad{border-color:var(--rose)}
.modal-close{float:right;width:28px;height:28px;background:var(--el);border:1px solid var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;color:var(--muted)}
.modal-close:hover{background:var(--rose);color:#fff}
.modal-ico{font-size:40px;text-align:center;margin-bottom:12px;clear:both}
.modal-title{font-size:18px;font-weight:700;text-align:center;margin-bottom:6px}
.modal-sub{font-size:11px;color:var(--muted);text-align:center;margin-bottom:16px}
.modal-val{font-size:40px;font-weight:700;text-align:center;margin-bottom:6px}
.modal-val.good{color:var(--emerald)}
.modal-val.bad{color:var(--rose)}
.modal-status{text-align:center;padding:8px 12px;border-radius:6px;font-size:11px;font-weight:600;margin-bottom:16px}
.modal-status.good{background:rgba(0,255,136,0.1);border:1px solid var(--emerald);color:var(--emerald)}
.modal-status.bad{background:rgba(255,51,102,0.1);border:1px solid var(--rose);color:var(--rose)}
.modal-section{background:var(--el);border-radius:10px;padding:14px;margin-bottom:10px}
.modal-section-title{font-size:9px;font-weight:700;color:var(--cyan);margin-bottom:6px;text-transform:uppercase}
.modal-section-text{font-size:11px;color:var(--dim);line-height:1.5}
.modal-section-text strong{color:var(--text)}
.modal-formula{font-family:monospace;font-size:10px;color:var(--purple);background:var(--bg);padding:10px;border-radius:6px;margin-top:8px;overflow-x:auto}
.loading-bg{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.95);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:300;opacity:0;pointer-events:none;transition:opacity 0.3s}
.loading-bg.show{opacity:1;pointer-events:all}
.spinner{width:50px;height:50px;border:3px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{margin-top:16px;font-size:13px;font-weight:600;color:var(--gold)}
.loading-step{margin-top:6px;font-size:10px;color:var(--muted)}
</style>
</head>
<body>
<div class="bg-effects"><div class="bg-orb o1"></div><div class="bg-orb o2"></div></div>
<nav class="top-nav">
  <div class="top-inner">
    <div class="brand"><div class="brand-icon">üåô</div><div><h1>Ramadan Co-Pilot</h1><span>BURAK Engine v2.0 PRO</span></div></div>
    <div class="top-stats">
      <div class="top-stat"><div class="top-stat-val pos" id="statGap">+580</div><div class="top-stat-lbl">Daily Gap</div></div>
      <div class="top-stat"><div class="top-stat-val pos" id="statFat">-2.3kg</div><div class="top-stat-lbl">30-Day</div></div>
      <div class="top-stat"><div class="top-stat-val pos" id="statLiver">-22%</div><div class="top-stat-lbl">Liver</div></div>
    </div>
    <div class="mode-ind deficit" id="modeInd"><div class="dot"></div><span>Fat Burning</span></div>
  </div>
</nav>
<main class="main">
  <aside class="panel">
    <section class="section">
      <div class="sec-head"><div class="sec-icon">üìä</div><div class="sec-title">Body Profile</div></div>
      <div class="input-row">
        <div class="input-card"><input type="number" id="inWeight" value="85" onchange="recalc()"><label>Weight (kg)</label></div>
        <div class="input-card"><input type="number" id="inHeight" value="175" onchange="recalc()"><label>Height (cm)</label></div>
      </div>
      <div class="input-row">
        <div class="input-card"><input type="number" id="inAge" value="38" onchange="recalc()"><label>Age</label></div>
        <div class="input-card"><input type="number" id="inWaist" value="95" onchange="recalc()"><label>Waist (cm)</label></div>
      </div>
    </section>
    <section class="section">
      <div class="sec-head"><div class="sec-icon">üçΩÔ∏è</div><div class="sec-title">Daily Intake</div><div class="sec-badge">500-6000</div></div>
      <div class="slider-card">
        <div class="slider-head">
          <div class="slider-info"><div class="lbl">Suhoor + Iftar</div><div class="sub">Total daily calories</div></div>
          <div class="slider-val cal" id="calVal">1800<span class="unit">kcal</span></div>
        </div>
        <div class="slider-track"><div class="slider-fill cal" id="calFill" style="width:24%"></div></div>
        <input type="range" id="calSlider" min="500" max="6000" value="1800" step="50" oninput="updateCal()">
        <div class="slider-marks"><span>500</span><span>2000</span><span>3500</span><span>5000</span><span>6000</span></div>
      </div>
    </section>
    <section class="section">
      <div class="sec-head"><div class="sec-icon">‚è∞</div><div class="sec-title">Fasting Window</div></div>
      <div class="slider-card">
        <div class="slider-head">
          <div class="slider-info"><div class="lbl">Hours Fasting</div><div class="sub">Dawn to sunset + night</div></div>
          <div class="slider-val fast" id="fastVal">14<span class="unit">hrs</span></div>
        </div>
        <div class="slider-track"><div class="slider-fill fast" id="fastFill" style="width:43%"></div></div>
        <input type="range" id="fastSlider" min="8" max="22" value="14" oninput="updateFast()">
        <div class="slider-marks"><span>8h</span><span>12h</span><span>16h</span><span>20h</span><span>22h</span></div>
      </div>
    </section>
    <section class="section">
      <div class="sec-head"><div class="sec-icon">üèÉ</div><div class="sec-title">Activity Level</div></div>
      <div class="act-grid">
        <div class="act-btn" data-m="1.2" onclick="setAct(this)"><div class="ico">üßò</div><div class="name">Sedentary</div><div class="mult">√ó1.2</div></div>
        <div class="act-btn active" data-m="1.4" onclick="setAct(this)"><div class="ico">üö∂</div><div class="name">Light</div><div class="mult">√ó1.4</div></div>
        <div class="act-btn" data-m="1.55" onclick="setAct(this)"><div class="ico">üèÉ</div><div class="name">Moderate</div><div class="mult">√ó1.55</div></div>
        <div class="act-btn" data-m="1.725" onclick="setAct(this)"><div class="ico">üí™</div><div class="name">Active</div><div class="mult">√ó1.725</div></div>
        <div class="act-btn" data-m="1.9" onclick="setAct(this)"><div class="ico">üèãÔ∏è</div><div class="name">V.Active</div><div class="mult">√ó1.9</div></div>
        <div class="act-btn" data-m="2.2" onclick="setAct(this)"><div class="ico">‚ö°</div><div class="name">Athlete</div><div class="mult">√ó2.2</div></div>
      </div>
      <div class="flags">
        <div class="flag" id="flagDiab" onclick="toggleFlag('diab')"><div class="ico">üíâ</div><div class="txt">Diabetic</div></div>
        <div class="flag" id="flagPcos" onclick="toggleFlag('pcos')"><div class="ico">‚ôÄÔ∏è</div><div class="txt">PCOS</div></div>
        <div class="flag" id="flagNafld" onclick="toggleFlag('nafld')"><div class="ico">ü´Å</div><div class="txt">Fatty Liver</div></div>
      </div>
    </section>
    <div class="summary deficit" id="summaryBox">
      <div class="sum-eq">
        <div class="sum-term"><div class="val burn" id="sumBurn">2380</div><div class="lbl">TDEE</div></div>
        <div class="sum-op">‚àí</div>
        <div class="sum-term"><div class="val eat" id="sumEat">1800</div><div class="lbl">Intake</div></div>
        <div class="sum-op">=</div>
        <div class="sum-term"><div class="val gap" id="sumGap">+580</div><div class="lbl">Gap</div></div>
      </div>
      <div class="sum-msg good" id="sumMsg">‚úì Deficit: Burning ~580 kcal/day from body fat</div>
    </div>
    <button class="calc-btn" onclick="runEngine()">üßÆ Calculate 30-Day Projection</button>
  </aside>
  <section class="dash">
    <div class="welcome" id="welcome">
      <div class="welcome-icon">üß¨</div>
      <h2>Precision Biomarker Engine</h2>
      <p>Configure your profile and click Calculate for a 30-day metabolic projection with deep biomarker analysis.</p>
      <div class="welcome-grid">
        <div class="welcome-feat"><div class="ico">‚õìÔ∏è</div><div class="title">10-Step Cascade</div><div class="desc">Interconnected calculations</div></div>
        <div class="welcome-feat"><div class="ico">üß™</div><div class="title">Biomarker Dives</div><div class="desc">Insulin, liver, gut, inflammation</div></div>
        <div class="welcome-feat"><div class="ico">üõ°Ô∏è</div><div class="title">Disease Tracking</div><div class="desc">T2D, heart, liver risks</div></div>
        <div class="welcome-feat"><div class="ico">üìã</div><div class="title">Wellness Reports</div><div class="desc">Clinic-ready output</div></div>
      </div>
    </div>
    <div id="results"></div>
  </section>
</main>
<div class="loading-bg" id="loadingBg"><div class="spinner"></div><div class="loading-text">Running BURAK Engine v2.0</div><div class="loading-step" id="loadingStep">Calculating BMR...</div></div>
<div class="modal-bg" id="modalBg" onclick="closeModal(event)"><div class="modal" id="modal"><div class="modal-close" onclick="closeModal()">&times;</div><div id="modalContent"></div></div></div>
<script>
const $=id=>document.getElementById(id);
const S={cal:1800,fast:14,actM:1.4,flags:{diab:false,pcos:false,nafld:false}};
let E=null;
const F={
  bmr:()=>{const w=+$('inWeight').value||85,h=+$('inHeight').value||175,a=+$('inAge').value||38;return Math.round(10*w+6.25*h-5*a+5);},
  tdee:()=>Math.round(F.bmr()*S.actM),
  bf:()=>{const wa=+$('inWaist').value||95,h=+$('inHeight').value||175;return Math.round(Math.max(8,Math.min(45,(wa/h)*100-18))*10)/10;},
  visc:()=>{const wa=+$('inWaist').value||95,h=+$('inHeight').value||175;return Math.round(Math.max(5,Math.min(25,(wa/h)*30-5))*10)/10;}
};
function runCascade(inp){
  const days=[];
  let st={wt:inp.wt,liver:S.flags.nafld?28:18,visc:inp.visc,gut:0.65,inf:8,insSens:S.flags.diab?0.45:(S.flags.pcos?0.55:0.8)};
  for(let d=1;d<=30;d++){
    const c={};
    const gap=inp.tdee-inp.cal,isDef=gap>0;
    c.s1={name:"Energy Balance",icon:"‚ö°",val:gap,unit:"kcal",good:isDef,formula:"TDEE("+inp.tdee+") - Intake("+inp.cal+") = "+gap,explain:isDef?"Body needs "+gap+" kcal more than consumed. Energy from stored fat.":"Surplus of "+Math.abs(gap)+" kcal being stored as fat."};
    const baseIns=S.flags.diab?22:(S.flags.pcos?15:10);
    const fastDrop=Math.min(0.45,(inp.fast/24)*0.45);
    const defDrop=isDef?Math.min(0.25,gap/2000):0;
    const surRise=!isDef?Math.min(0.35,Math.abs(gap)/1500):0;
    const insMult=1-fastDrop-defDrop+surRise;
    const curIns=baseIns*insMult;
    const insChg=((curIns-baseIns)/baseIns)*100;
    if(isDef)st.insSens=Math.min(0.95,st.insSens+0.012);else st.insSens=Math.max(0.3,st.insSens-0.008);
    c.s2={name:"Insulin Level",icon:"üíâ",val:insChg,unit:"%",good:insChg<0,raw:{base:baseIns,cur:curIns,sens:st.insSens},formula:"I = "+baseIns+" √ó (1 - "+fastDrop.toFixed(2)+" - "+defDrop.toFixed(2)+" + "+surRise.toFixed(2)+") = "+curIns.toFixed(1),explain:insChg<0?"Insulin ‚Üì"+Math.abs(Math.round(insChg))+"%. Fat cells releasing energy.":"Insulin ‚Üë"+Math.round(insChg)+"%. Fat cells in storage mode."};
    const insNorm=curIns/25,fastF=Math.min(1,inp.fast/18),defF=isDef?Math.min(1,gap/1000):0;
    let fbr=(1-insNorm)*fastF*(0.25+defF*0.75);fbr=Math.max(0.1,Math.min(0.92,fbr));
    const fbPct=Math.round(fbr*100);
    c.s3={name:"Fuel Selection",icon:"üî•",val:fbPct,unit:"% fat",good:fbPct>50,raw:{ratio:fbr},formula:"FSR = (1-"+insNorm.toFixed(2)+") √ó "+fastF.toFixed(2)+" √ó (0.25+"+defF.toFixed(2)+"√ó0.75) = "+fbPct+"%",explain:fbPct>50?"Burning "+fbPct+"% fat, "+(100-fbPct)+"% glucose.":"Burning "+(100-fbPct)+"% glucose, only "+fbPct+"% fat."};
    let liverChg;
    if(isDef)liverChg=-fbr*(gap/7700)*3.5;else liverChg=insNorm*(Math.abs(gap)/7700)*2.5;
    st.liver=Math.max(3,Math.min(45,st.liver+liverChg));
    const cumLiver=((st.liver-(S.flags.nafld?28:18))/(S.flags.nafld?28:18))*100;
    c.s4={name:"Liver Fat",icon:"ü´Å",val:cumLiver,unit:"%",good:cumLiver<0,raw:{cur:st.liver},formula:isDef?"ŒîL = -"+fbr.toFixed(2)+" √ó ("+gap+"/7700) √ó 3.5":"ŒîL = +"+insNorm.toFixed(2)+" √ó ("+Math.abs(gap)+"/7700) √ó 2.5",explain:cumLiver<0?"Liver fat ‚Üì"+Math.abs(Math.round(cumLiver))+"%. Hepatic function improving.":"Liver fat ‚Üë"+Math.round(cumLiver)+"%. Metabolic function impaired."};
    const liverH=Math.max(0.3,1-(st.liver/50));
    let keto;if(isDef&&inp.fast>=12)keto=1.8*fbr*(1-insNorm)*liverH;else keto=0.1+(inp.fast>14?0.15:0);
    keto=Math.max(0.1,Math.min(3,keto));
    c.s5={name:"Ketones",icon:"üß™",val:keto,unit:"mmol/L",good:keto>0.5,formula:"K = 1.8 √ó "+fbr.toFixed(2)+" √ó (1-"+insNorm.toFixed(2)+") √ó "+liverH.toFixed(2)+" = "+keto.toFixed(2),explain:keto>0.5?"Ketosis at "+keto.toFixed(2)+" mmol/L. Brain using ketones.":"Low ketones "+keto.toFixed(2)+" mmol/L. Brain on glucose."};
    let mmc;if(inp.fast>=10)mmc=Math.min(1,(inp.fast-6)/10);else mmc=0.25;
    const mmcPct=Math.round(mmc*100);
    c.s6={name:"Gut Motility",icon:"üßπ",val:mmcPct,unit:"% MMC",good:mmcPct>60,raw:{act:mmc},formula:"MMC = min(1, ("+inp.fast+"-6)/10) = "+mmcPct+"%",explain:mmcPct>60?"MMC "+mmcPct+"% active. Gut cleaning well.":"MMC only "+mmcPct+"%. Cleaning suppressed."};
    const repR=mmc*0.012,dmgR=(st.inf/20)*0.006;
    if(isDef&&mmc>0.5)st.gut=Math.min(0.95,st.gut+repR-dmgR);else st.gut=Math.max(0.4,st.gut-dmgR*1.5);
    const gutChg=((st.gut-0.65)/0.65)*100;
    c.s7={name:"Gut Barrier",icon:"üß±",val:gutChg,unit:"%",good:gutChg>0,raw:{int:st.gut},formula:"G = 0.65 + "+repR.toFixed(4)+" - "+dmgR.toFixed(4)+" = "+st.gut.toFixed(2),explain:gutChg>0?"Gut barrier ‚Üë"+Math.round(gutChg)+"%. Less permeability.":"Gut barrier ‚Üì"+Math.abs(Math.round(gutChg))+"%. Leaky gut risk."};
    const lps=(1-st.gut)*100,lpsChg=-gutChg*0.8;
    c.s8={name:"Endotoxins",icon:"‚ò†Ô∏è",val:lpsChg,unit:"%",good:lpsChg<0,raw:{lps:lps},formula:"LPS = (1-"+st.gut.toFixed(2)+") √ó 100 = "+lps.toFixed(1)+"%",explain:lpsChg<0?"LPS leakage ‚Üì"+Math.abs(Math.round(lpsChg))+"%. Less toxins in blood.":"LPS leakage ‚Üë"+Math.round(lpsChg)+"%. Metabolic endotoxemia."};
    const lpsC=lps*0.06,liverC=st.liver*0.18,viscC=st.visc*0.12;
    st.inf=lpsC+liverC+viscC;
    const infChg=((st.inf-8)/8)*100;
    c.s9={name:"Inflammation",icon:"üî¥",val:infChg,unit:"%",good:infChg<0,raw:{tot:st.inf,crp:st.inf/4},formula:"Inf = "+lps.toFixed(1)+"√ó0.06 + "+st.liver.toFixed(1)+"√ó0.18 + "+st.visc.toFixed(1)+"√ó0.12 = "+st.inf.toFixed(1),explain:infChg<0?"Inflammation ‚Üì"+Math.abs(Math.round(infChg))+"%. CRP dropping.":"Inflammation ‚Üë"+Math.round(infChg)+"%. CRP rising."};
    const diabR=isDef?-Math.round(d*1.1*(S.flags.diab?1.6:1)):Math.round(d*0.8*(S.flags.diab?1.4:1));
    const heartR=isDef?-Math.round(d*0.85):Math.round(d*0.6);
    const liverR=isDef?-Math.round(d*1.3*(S.flags.nafld?1.5:1)):Math.round(d*0.9*(S.flags.nafld?1.3:1));
    const metaR=isDef?-Math.round(d*0.95):Math.round(d*0.7);
    const overR=(diabR+heartR+liverR+metaR)/4;
    c.s10={name:"Disease Risk",icon:"üõ°Ô∏è",val:overR,unit:"%",good:overR<0,raw:{diab:diabR,heart:heartR,liver:liverR,meta:metaR},formula:"Risk = f(insulin, liver, inflammation, visceral)",explain:overR<0?"Disease trajectory ‚Üì"+Math.abs(Math.round(overR))+"%. Health improving.":"Disease risk ‚Üë"+Math.round(overR)+"%. Consider reducing intake."};
    const dailyFat=isDef?gap/7700:-Math.abs(gap)/7700;
    st.wt-=dailyFat;
    if(isDef)st.visc=Math.max(4,st.visc-(fbr*gap/7700*0.55));else st.visc=Math.min(35,st.visc+(Math.abs(gap)/7700*0.35));
    days.push({day:d,c:c,st:JSON.parse(JSON.stringify(st)),isDef:isDef,wtChg:inp.wt-st.wt,fatLoss:dailyFat*d});
  }
  return days;
}
function runEngine(){
  $('loadingBg').classList.add('show');
  const steps=['Calculating BMR...','Computing TDEE...','Modeling insulin...','Running liver metabolism...','Analyzing gut...','Calculating inflammation...','Projecting disease...','Generating report...'];
  let i=0;const int=setInterval(()=>{if(i<steps.length)$('loadingStep').textContent=steps[i++];},120);
  setTimeout(()=>{
    clearInterval(int);
    const inp={wt:+$('inWeight').value||85,ht:+$('inHeight').value||175,age:+$('inAge').value||38,bf:F.bf(),visc:F.visc(),tdee:F.tdee(),cal:S.cal,fast:S.fast};
    E={inp:inp,days:runCascade(inp)};
    $('loadingBg').classList.remove('show');
    $('welcome').style.display='none';
    render();
  },1000);
}
function render(){
  const d30=E.days[29],isDef=d30.isDef;
  let h='<div class="res-head"><h2 class="res-title">30-Day Projection</h2><div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap"><div class="day-sel"><label>Day</label><input type="range" id="daySlider" min="1" max="30" value="30" oninput="upDay(this.value)"><div class="day-badge" id="dayBadge">Day 30</div></div></div></div>';
  h+='<div class="state-card"><div class="state-head">Body State</div><div class="state-grid" id="stateGrid"></div></div>';
  h+='<div class="cascade-card"><div class="cascade-head"><div class="cascade-title">10-Step Cascade</div><div class="cascade-legend"><span><div class="dot good"></div>Good</span><span><div class="dot bad"></div>Bad</span></div></div><div class="cascade-flow" id="cascadeFlow"></div></div>';
  h+='<div class="deep-grid" id="deepGrid"></div>';
  h+='<div class="disease-card"><div class="disease-head">Disease Risk</div><div class="disease-grid" id="diseaseGrid"></div></div>';
  h+='<div class="story-card"><div class="story-head">üåô Your Ramadan Journey</div><div class="story-text" id="storyText"></div></div>';
  h+='<div class="report-card"><div class="report-head"><div class="report-title">üìã Wellness Report</div><div class="report-btns"><button class="report-btn" onclick="window.print()">üñ®Ô∏è Print</button><button class="report-btn primary">üì§ Export</button></div></div><div class="report-summary" id="reportSum"></div><div class="report-recs" id="reportRecs"></div></div>';
  $('results').innerHTML=h;
  upDay(30);
}
function upDay(n){
  n=+n;$('dayBadge').textContent='Day '+n;
  const d=E.days[n-1],c=d.c,st=d.st,isDef=d.isDef;
  const modeEl=$('modeInd');
  modeEl.className='mode-ind '+(isDef?'deficit':'surplus');
  modeEl.innerHTML='<div class="dot"></div><span>'+(isDef?'Fat Burning':'Fat Storage')+'</span>';
  const stItems=[{ico:'‚öñÔ∏è',lbl:'Weight',val:d.wtChg.toFixed(1),unit:'kg',good:d.wtChg>=0},{ico:'ü´Å',lbl:'Liver',val:st.liver.toFixed(1),unit:'%',good:st.liver<18},{ico:'ü¶†',lbl:'Gut',val:Math.round(st.gut*100),unit:'%',good:st.gut>0.65},{ico:'üî•',lbl:'Inflam',val:st.inf.toFixed(1),unit:'',good:st.inf<8},{ico:'üíâ',lbl:'Ins.Sens',val:Math.round(st.insSens*100),unit:'%',good:st.insSens>0.7}];
  $('stateGrid').innerHTML=stItems.map(i=>'<div class="state-item"><div class="ico">'+i.ico+'</div><div class="val '+(i.good?'good':'bad')+'">'+i.val+i.unit+'</div><div class="lbl">'+i.lbl+'</div></div>').join('');
  const steps=['s1','s2','s3','s4','s5','s6','s7','s8','s9','s10'];
  let cascH='';
  steps.forEach((sk,i)=>{
    const s=c[sk];
    let dv;
    if(s.unit==='kcal')dv=(s.val>=0?'+':'')+s.val;
    else if(s.unit==='mmol/L')dv=s.val.toFixed(2);
    else if(s.unit==='% fat'||s.unit==='% MMC')dv=s.val+'%';
    else dv=(s.val>=0?'+':'')+Math.round(s.val)+'%';
    const bw=Math.min(100,Math.abs(s.val)/(s.unit==='kcal'?15:s.unit==='mmol/L'?0.03:1.2));
    cascH+='<div class="casc-step '+(s.good?'good':'bad')+'" onclick="showModal('+i+','+n+')"><div class="casc-num">'+(i+1)+'</div><div class="casc-info"><div class="casc-name">'+s.icon+' '+s.name+'</div><div class="casc-formula">'+s.formula.substring(0,40)+(s.formula.length>40?'...':'')+'</div></div><div class="casc-bar"><div class="casc-fill '+(s.good?'good':'bad')+'" style="width:'+bw+'%"></div></div><div class="casc-val '+(s.good?'good':'bad')+'">'+dv+'</div></div>';
    if(i<9)cascH+='<div class="casc-arrow">‚Üì</div>';
  });
  $('cascadeFlow').innerHTML=cascH;
  const deeps=[{key:'insulin',title:'Insulin',sub:'Fat storage control',ico:'üíâ',val:c.s2.raw.cur.toFixed(1),unit:'ŒºU/mL',good:c.s2.good,metrics:[{l:'Base',v:c.s2.raw.base,g:true},{l:'Change',v:Math.round(c.s2.val)+'%',g:c.s2.good},{l:'Sens',v:Math.round(st.insSens*100)+'%',g:st.insSens>0.7}],insight:c.s2.explain},{key:'liver',title:'Liver Fat',sub:'Hepatic steatosis',ico:'ü´Å',val:st.liver.toFixed(1),unit:'%',good:st.liver<18,metrics:[{l:'Current',v:st.liver.toFixed(1)+'%',g:st.liver<15},{l:'Change',v:Math.round(c.s4.val)+'%',g:c.s4.good},{l:'Capacity',v:Math.round((1-st.liver/50)*100)+'%',g:st.liver<20}],insight:c.s4.explain},{key:'gut',title:'Gut Health',sub:'Microbiome status',ico:'ü¶†',val:Math.round(st.gut*100),unit:'%',good:st.gut>0.65,metrics:[{l:'Integrity',v:Math.round(st.gut*100)+'%',g:st.gut>0.7},{l:'MMC',v:c.s6.val+'%',g:c.s6.good},{l:'LPS',v:Math.round(c.s8.raw.lps)+'%',g:c.s8.raw.lps<30}],insight:c.s7.explain},{key:'inflammation',title:'Inflammation',sub:'Systemic markers',ico:'üî•',val:st.inf.toFixed(1),unit:'score',good:st.inf<8,metrics:[{l:'CRP',v:(st.inf/4).toFixed(1)+' mg/L',g:st.inf<8},{l:'Change',v:Math.round(c.s9.val)+'%',g:c.s9.good},{l:'Sources',v:'3 active',g:st.inf<10}],insight:c.s9.explain}];
  $('deepGrid').innerHTML=deeps.map(dd=>'<div class="deep-card '+dd.key+'"><div class="deep-head"><div class="deep-title"><div class="ico">'+dd.ico+'</div><div><h3>'+dd.title+'</h3><span>'+dd.sub+'</span></div></div><div class="deep-value"><div class="num '+(dd.good?'good':'bad')+'">'+dd.val+'</div><div class="unit">'+dd.unit+'</div></div></div><div class="deep-gauge"><div class="deep-gauge-marker" style="left:'+(dd.good?'25':'70')+'%"></div></div><div class="deep-metrics">'+dd.metrics.map(m=>'<div class="deep-metric"><div class="v '+(m.g?'good':'bad')+'">'+m.v+'</div><div class="l">'+m.l+'</div></div>').join('')+'</div><div class="deep-insight"><div class="deep-insight-title">Status</div><div class="deep-insight-text">'+dd.insight+'</div></div></div>').join('');
  const diseases=[{ico:'üíâ',name:'Type 2 Diabetes',val:c.s10.raw.diab},{ico:'‚ù§Ô∏è',name:'Heart Disease',val:c.s10.raw.heart},{ico:'ü´Å',name:'Fatty Liver',val:c.s10.raw.liver},{ico:'‚öñÔ∏è',name:'Metabolic Syn.',val:c.s10.raw.meta}];
  $('diseaseGrid').innerHTML=diseases.map(dis=>'<div class="dis-item '+(dis.val<0?'good':'bad')+'"><div class="ico">'+dis.ico+'</div><div class="name">'+dis.name+'</div><div class="val '+(dis.val<0?'good':'bad')+'">'+(dis.val>=0?'+':'')+dis.val+'%</div><div class="trend '+(dis.val<0?'good':'bad')+'">'+(dis.val<0?'‚Üì Down':'‚Üë Up')+'</div></div>').join('');
  const story=isDef?'After <strong>'+n+' days</strong> in deficit, your body adapted well. Daily gap of <strong class="hl">'+c.s1.val+' kcal</strong> mobilized fat stores. Insulin ‚Üì<strong class="hl">'+Math.abs(Math.round(c.s2.val))+'%</strong>. Burning <strong class="hl">'+c.s3.val+'% fat</strong>. Liver fat at <strong class="hl">'+st.liver.toFixed(1)+'%</strong>. Ketones <strong class="hl">'+c.s5.val.toFixed(2)+' mmol/L</strong>. Gut health <strong class="hl">'+Math.round(st.gut*100)+'%</strong>. Inflammation <strong class="hl">'+st.inf.toFixed(1)+'</strong>. Weight change: <strong class="hl">'+d.wtChg.toFixed(1)+' kg</strong>.':'After <strong>'+n+' days</strong> in surplus, body is storing fat. Surplus of <strong class="warn">'+Math.abs(c.s1.val)+' kcal</strong> converted to fat. Insulin ‚Üë<strong class="warn">'+Math.round(c.s2.val)+'%</strong>. Only burning <strong class="warn">'+c.s3.val+'% fat</strong>. Liver fat <strong class="warn">'+st.liver.toFixed(1)+'%</strong>. Minimal ketones. Gut health <strong class="warn">'+Math.round(st.gut*100)+'%</strong>. Inflammation <strong class="warn">'+st.inf.toFixed(1)+'</strong>. Weight gain: <strong class="warn">+'+Math.abs(d.wtChg).toFixed(1)+' kg</strong>. <br><br><strong>Tip:</strong> Reduce Iftar portions or increase activity.';
  $('storyText').innerHTML=story;
  const rptCards=[{title:'Weight',val:(d.wtChg>=0?'-':'+')+Math.abs(d.wtChg).toFixed(1)+' kg',good:d.wtChg>=0,desc:n+'-day projection'},{title:'Metabolic',val:isDef?'Improving':'Declining',good:isDef,desc:'Insulin sens: '+Math.round(st.insSens*100)+'%'},{title:'Risk',val:Math.round(c.s10.val)+'%',good:c.s10.val<0,desc:'Composite trajectory'}];
  $('reportSum').innerHTML=rptCards.map(c=>'<div class="rpt-card"><div class="rpt-card-head"><div class="rpt-card-title">'+c.title+'</div><div class="rpt-card-badge '+(c.good?'good':'bad')+'">'+(c.good?'On Track':'Attention')+'</div></div><div class="rpt-card-val '+(c.good?'good':'bad')+'">'+c.val+'</div><div class="rpt-card-desc">'+c.desc+'</div></div>').join('');
  const recs=isDef?[{ico:'‚úÖ',txt:'<strong>Continue:</strong> Your deficit is optimal.'},{ico:'üíß',txt:'<strong>Hydrate:</strong> 2-3L between Iftar & Suhoor.'},{ico:'ü•ó',txt:'<strong>Protein:</strong> 1.6g/kg to preserve muscle.'},{ico:'üö∂',txt:'<strong>Walk:</strong> 20-30 min after Iftar.'}]:[{ico:'‚ö†Ô∏è',txt:'<strong>Reduce:</strong> Cut Iftar by 300-500 kcal.'},{ico:'üçΩÔ∏è',txt:'<strong>Mindful:</strong> Start with soup & salad.'},{ico:'üèÉ',txt:'<strong>Exercise:</strong> Add 30-45 min activity.'},{ico:'üö´',txt:'<strong>Limit sweets:</strong> Reduce sugary drinks.'}];
  $('reportRecs').innerHTML='<div class="recs-title">Recommendations</div><div class="recs-list">'+recs.map(r=>'<div class="rec-item"><div class="ico">'+r.ico+'</div><div class="txt">'+r.txt+'</div></div>').join('')+'</div>';
}
function showModal(idx,day){
  const d=E.days[day-1],steps=['s1','s2','s3','s4','s5','s6','s7','s8','s9','s10'],s=d.c[steps[idx]];
  $('modal').className='modal '+(s.good?'good':'bad');
  let dv;
  if(s.unit==='kcal')dv=(s.val>=0?'+':'')+s.val+' kcal';
  else if(s.unit==='mmol/L')dv=s.val.toFixed(2)+' mmol/L';
  else dv=(s.val>=0?'+':'')+Math.round(s.val)+s.unit;
  $('modalContent').innerHTML='<div class="modal-ico">'+s.icon+'</div><div class="modal-title">Step '+(idx+1)+': '+s.name+'</div><div class="modal-sub">Cascade Position '+(idx+1)+'/10</div><div class="modal-val '+(s.good?'good':'bad')+'">'+dv+'</div><div class="modal-status '+(s.good?'good':'bad')+'">'+(s.good?'‚úì Working FOR you':'‚ö†Ô∏è Working AGAINST you')+'</div><div class="modal-section"><div class="modal-section-title">What This Means</div><div class="modal-section-text">'+s.explain+'</div></div><div class="modal-section"><div class="modal-section-title">üìê Formula</div><div class="modal-formula">'+s.formula+'</div></div>'+(idx>0?'<div class="modal-section"><div class="modal-section-title">‚õìÔ∏è Dependencies</div><div class="modal-section-text">This depends on outputs from <strong>Steps 1-'+idx+'</strong>. Changes upstream affect this value.</div></div>':'');
  $('modalBg').classList.add('show');
}
function closeModal(e){if(!e||e.target===$('modalBg'))$('modalBg').classList.remove('show');}
function updateCal(){S.cal=+$('calSlider').value;$('calVal').innerHTML=S.cal+'<span class="unit">kcal</span>';$('calFill').style.width=((S.cal-500)/(6000-500)*100)+'%';recalc();}
function updateFast(){S.fast=+$('fastSlider').value;$('fastVal').innerHTML=S.fast+'<span class="unit">hrs</span>';$('fastFill').style.width=((S.fast-8)/(22-8)*100)+'%';recalc();}
function setAct(el){document.querySelectorAll('.act-btn[data-m]').forEach(b=>b.classList.remove('active'));el.classList.add('active');S.actM=+el.dataset.m;recalc();}
function toggleFlag(f){S.flags[f]=!S.flags[f];const el=$('flag'+f.charAt(0).toUpperCase()+f.slice(1));el.classList.toggle('active',S.flags[f]);recalc();}
function recalc(){
  const tdee=F.tdee(),gap=tdee-S.cal,isDef=gap>0;
  $('sumBurn').textContent=tdee;$('sumEat').textContent=S.cal;$('sumGap').textContent=(gap>=0?'+':'')+gap;$('sumGap').className='val '+(isDef?'gap':'excess');
  $('summaryBox').className='summary '+(isDef?'deficit':'surplus');$('sumMsg').className='sum-msg '+(isDef?'good':'bad');$('sumMsg').textContent=isDef?'‚úì Deficit: Burning ~'+gap+' kcal/day from body fat':'‚ö†Ô∏è Surplus: Storing ~'+Math.abs(gap)+' kcal/day as fat';
  $('statGap').textContent=(gap>=0?'+':'')+gap;$('statGap').className='top-stat-val '+(isDef?'pos':'neg');
  const fat30=(gap*30/7700).toFixed(1);$('statFat').textContent=(+fat30>=0?'-':'+')+Math.abs(fat30)+'kg';$('statFat').className='top-stat-val '+(+fat30>=0?'pos':'neg');
  const liverEst=isDef?-Math.round(+fat30*8):Math.round(Math.abs(+fat30)*6);$('statLiver').textContent=(liverEst<=0?'':'+')+(liverEst)+'%';$('statLiver').className='top-stat-val '+(liverEst<=0?'pos':'neg');
  const modeEl=$('modeInd');modeEl.className='mode-ind '+(isDef?'deficit':'surplus');modeEl.innerHTML='<div class="dot"></div><span>'+(isDef?'Fat Burning':'Fat Storage')+'</span>';
}
recalc();
</script>
</body>
</html>
